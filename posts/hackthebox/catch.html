<!DOCTYPE html><html lang="en"mode="dark"><!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now"><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Catch - HackTheBox" />
<meta property="og:locale" content="en" />
<meta name="description" content="Catch is a very interesting medium-rated linux box on HackTheBox. It starts with some light reversing of an android application to obtain an access token for the Let’s Chat API running on the host. This token will lead you to some credentials in the chat logs, which are reused in the Cachet instance running on the host, which you can exploit to leak the application config and obtain a password that was reused for SSH login. Once inside the box, you will be exploiting a custom cron job that process user controlled files in an unsafe way, leading to code execution as root." />
<meta property="og:description" content="Catch is a very interesting medium-rated linux box on HackTheBox. It starts with some light reversing of an android application to obtain an access token for the Let’s Chat API running on the host. This token will lead you to some credentials in the chat logs, which are reused in the Cachet instance running on the host, which you can exploit to leak the application config and obtain a password that was reused for SSH login. Once inside the box, you will be exploiting a custom cron job that process user controlled files in an unsafe way, leading to code execution as root." />
<link rel="canonical" href="https://4g3nt47.github.io/posts/hackthebox/catch.html" />
<meta property="og:url" content="https://4g3nt47.github.io/posts/hackthebox/catch.html" />
<meta property="og:site_name" content="4g3nt47" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-08-16T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Catch - HackTheBox" />
<meta name="twitter:site" content="@UmarAbdoul" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Catch - HackTheBox","dateModified":"2022-08-16T00:00:00+01:00","url":"https://4g3nt47.github.io/posts/hackthebox/catch.html","datePublished":"2022-08-16T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://4g3nt47.github.io/posts/hackthebox/catch.html"},"description":"Catch is a very interesting medium-rated linux box on HackTheBox. It starts with some light reversing of an android application to obtain an access token for the Let’s Chat API running on the host. This token will lead you to some credentials in the chat logs, which are reused in the Cachet instance running on the host, which you can exploit to leak the application config and obtain a password that was reused for SSH login. Once inside the box, you will be exploiting a custom cron job that process user controlled files in an unsafe way, leading to code execution as root.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>Catch - HackTheBox | 4g3nt47
  </title><!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
--><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="4g3nt47">
<meta name="application-name" content="4g3nt47">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA --><!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/css/all.min.css"><!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet"
    href="/assets/css/bootstrap-toc.min.css"><!-- Manific Popup -->
  <link rel="stylesheet" href="/assets/css/magnific-popup.min.css"><!-- JavaScript -->

  <script src="/assets/js/jquery.min.js"></script>

</head>
<body data-spy="scroll" data-target="#toc"><!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto"><img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"></a>
    </div>

    <div class="site-title mt-3">
      <a href="/">4g3nt47</a>
    </div>
    <div class="site-subtitle font-italic">Welcome to my infosec blog</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs --><li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i><span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i><span>TAGS</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i><span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i><span>ABOUT</span>
      </a>
    </li> <!-- .nav-item --></ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"><a href="https://github.com/4g3nt47" aria-label="github"target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a><a href="https://twitter.com/UmarAbdoul" aria-label="twitter"target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a><a href="javascript:location.href = 'mailto:' + ['aufaruq02','gmail.com'].join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a><a href="/rss/feed.xml" aria-label="rss">
        <i class="fas fa-rss"></i>
      </a></div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->
<!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb"><span>
            <a href="/">
              Home
            </a>
          </span><span>Catch - HackTheBox</span></span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">Post</div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>
<div id="main-wrapper">
      <div id="main">

        <div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
  Refactor the HTML structure.
--><!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
--><!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
--><!-- Add attribute 'hide-bullet' to the checkbox list --><!-- images --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add header for code snippets --><!-- Create heading anchors --><!-- return -->

<h1 data-toc-skip>Catch - HackTheBox</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>By
    <em><a href="https://twitter.com/UmarAbdoul">Umar Abdul</a></em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted<!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeago"
    date="2022-08-16 00:00:00 +0100"data-toggle="tooltip"
      data-placement="bottom"
      title="Tue, Aug 16, 2022, 12:00 AM +0100">Aug 16</em>
</span>

      <!-- lastmod date --><!-- read time --><!--
  Calculate the post's reading time, and display the word count in tooltip
 --><!-- words per minute  --><!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="2777 words">
  <em>15 min</em> read</span>
<!-- page views --></div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p><strong>Catch</strong> is a very interesting <em>medium-rated</em> linux box on <em>HackTheBox</em>. It starts with some light reversing of an android application to obtain an access token for the <em>Let’s Chat</em> API running on the host. This token will lead you to some credentials in the chat logs, which are reused in the <em>Cachet</em> instance running on the host, which you can exploit to leak the application config and obtain a password that was reused for SSH login. Once inside the box, you will be exploiting a custom cron job that process user controlled files in an unsafe way, leading to code execution as <code class="language-plaintext highlighter-rouge">root</code>.</p>

<p><br /></p>

<h3 id="info">Info<a href="#info" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p><img data-src="/assets/img/20220317072018.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20220317072038.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="recon">Recon<a href="#recon" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="nmap">NMAP<a href="#nmap" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
</pre></td><td class="rouge-code"><pre># Nmap 7.70 scan initiated Mon Mar 14 06:44:58 2022 as: nmap -sC -sV -oN nmap.txt -v 10.10.11.150
Nmap scan report for catch.htb (10.10.11.150)
Host is up (0.36s latency).
Not shown: 995 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Catch Global Systems
3000/tcp open  ppp?
| fingerprint-strings: 
|   GenericLines, Help, RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Content-Type: text/html; charset=UTF-8
|     Set-Cookie: i_like_gitea=f9ae0e9b88600477; Path=/; HttpOnly
|     Set-Cookie: _csrf=1thsrzl3dfhhgLXqP2EYU0Yr2VU6MTY0NzIzNjc0NjEwNzA3MDM1NQ; Path=/; Expires=Tue, 15 Mar 2022 05:45:46 GMT; HttpOnly; SameSite=Lax
|     Set-Cookie: macaron_flash=; Path=/; Max-Age=0; HttpOnly
|     X-Frame-Options: SAMEORIGIN
|     Date: Mon, 14 Mar 2022 05:45:46 GMT
|     &lt;!DOCTYPE html&gt;
|     &lt;html lang="en-US" class="theme-"&gt;
|     &lt;head data-suburl=""&gt;
|     &lt;meta charset="utf-8"&gt;
|     &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
|     &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;
|     &lt;title&gt; Catch Repositories &lt;/title&gt;
|     &lt;link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ2F0Y2ggUmVwb3NpdG9yaWVzIiwic2hvcnRfbmFtZSI6IkNhdGNoIFJlcG9zaXRvcmllcyIsInN0YXJ0X3VybCI6Imh0dHA6Ly9naXRlYS5jYXRjaC5odGI6MzAwMC8iLCJpY29ucyI6W3sic3JjIjoiaHR0cDovL2dpdGVhLmNhdGNoLmh0Yjoz
|   HTTPOptions: 
|     HTTP/1.0 405 Method Not Allowed
|     Set-Cookie: i_like_gitea=e96c0ccbcd15e95b; Path=/; HttpOnly
|     Set-Cookie: _csrf=idequJw78CbNGhYDHkv0-BdGyA06MTY0NzIzNjc1NDIxOTc0MjU3Nw; Path=/; Expires=Tue, 15 Mar 2022 05:45:54 GMT; HttpOnly; SameSite=Lax
|     Set-Cookie: macaron_flash=; Path=/; Max-Age=0; HttpOnly
|     X-Frame-Options: SAMEORIGIN
|     Date: Mon, 14 Mar 2022 05:45:54 GMT
|_    Content-Length: 0
5000/tcp open  upnp?
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, RTSPRequest, SMBProgNeg, ZendJavaBridge: 
|     HTTP/1.1 400 Bad Request
|     Connection: close
|   GetRequest: 
|     HTTP/1.1 302 Found
|     X-Frame-Options: SAMEORIGIN
|     X-Download-Options: noopen
|     X-Content-Type-Options: nosniff
|     X-XSS-Protection: 1; mode=block
|     Content-Security-Policy: 
|     X-Content-Security-Policy: 
|     X-WebKit-CSP: 
|     X-UA-Compatible: IE=Edge,chrome=1
|     Location: /login
|     Vary: Accept, Accept-Encoding
|     Content-Type: text/plain; charset=utf-8
|     Content-Length: 28
|     Set-Cookie: connect.sid=s%3AhXxhtsBrUI_XDU_i3ZgGjgu033W-HpWG.KVpt61zx0JMhA1rttVRXksZCCwcY0tu9zcySTvWADoI; Path=/; HttpOnly
|     Date: Mon, 14 Mar 2022 05:45:50 GMT
|     Connection: close
|     Found. Redirecting to /login
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     X-Frame-Options: SAMEORIGIN
|     X-Download-Options: noopen
|     X-Content-Type-Options: nosniff
|     X-XSS-Protection: 1; mode=block
|     Content-Security-Policy: 
|     X-Content-Security-Policy: 
|     X-WebKit-CSP: 
|     X-UA-Compatible: IE=Edge,chrome=1
|     Allow: GET,HEAD
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 8
|     ETag: W/"8-ZRAf8oNBS3Bjb/SU2GYZCmbtmXg"
|     Set-Cookie: connect.sid=s%3Aq0XcpC9e25YC_BRaqUaIpr7SAkXEtcer.%2BQNjRwdTsHh5gZU8NxXCD0%2F02xispYhj9lSo2TGZgmQ; Path=/; HttpOnly
|     Vary: Accept-Encoding
|     Date: Mon, 14 Mar 2022 05:45:55 GMT
|     Connection: close
|_    GET,HEAD
8000/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 69A0E6A171C4ED8855408ED902951594
| http-methods: 
|_  Supported Methods: GET HEAD OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Catch Global Systems
2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :
==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============

---[snip]---

SF:"HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Mar 14 06:47:39 2022 -- 1 IP address (1 host up) scanned in 161.48 seconds
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h4 id="web-services">Web Services<a href="#web-services" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>The main service on port <strong>80</strong> appears to be static, with a download link to an APK file;</p>

<p><img data-src="/assets/img/20220317072352.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="gitea">Gitea<a href="#gitea" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>The service on port <strong>3000</strong> is an instance of <em>Gitea</em> version <strong>1.14.1</strong>;</p>

<p><img data-src="/assets/img/20220317072552.png" alt="" data-proofer-ignore></p>

<p>Viewing the source of the page showed a subdomain;</p>

<p><img data-src="/assets/img/20220317072626.png" alt="" data-proofer-ignore></p>

<p>Trying common usernames and passwords in the login page didn’t work. Only one user was found in the <em>explore</em> tab, and doesn’t have any repo;</p>

<p><img data-src="/assets/img/20220317073022.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<h4 id="lets-chat">Let’s Chat<a href="#lets-chat" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>The service on port <strong>5000</strong> is an instance of <em>Let’s Chat</em>, which is available at https://github.com/sdelements/lets-chat. This is a <em>self-hosted chat app for small teams</em>;</p>

<p><img data-src="/assets/img/20220317073230.png" alt="" data-proofer-ignore></p>

<p>Testing simple usernames and passwords in the login page didn’t yield anything.</p>

<p><br /></p>

<h4 id="cachet">Cachet<a href="#cachet" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>The service on port <strong>8000</strong> is an instance of <em>Cachet</em>, and according to it’s GitHub page, it is a <em>a beautiful and powerful open source status page system</em>;</p>

<p><img data-src="/assets/img/20220317073639.png" alt="" data-proofer-ignore></p>

<p>At the bottom of the page, there is a link to <code class="language-plaintext highlighter-rouge">/dashboard</code> and <code class="language-plaintext highlighter-rouge">/subscribe</code>. The <code class="language-plaintext highlighter-rouge">/subscribe</code> page gave a <strong>500</strong> internal server error, while the <code class="language-plaintext highlighter-rouge">/dashboard</code> redirected to <code class="language-plaintext highlighter-rouge">/auth/login</code>, which gave a login form;</p>

<p><img data-src="/assets/img/20220317073824.png" alt="" data-proofer-ignore></p>

<p>Some quick searches showed that this service is vulnerable to unauthenticated SQL injection;</p>

<p><img data-src="/assets/img/20220317074030.png" alt="" data-proofer-ignore></p>

<p>I looked for any sort of PoC for this vulnerability, but I couldn’t find any. So I installed the application locally to see if I can figure it out, but I couldn’t. The vulnerable function is defined in <code class="language-plaintext highlighter-rouge">app/Models/Traits/SearchableTrait.php</code>;</p>

<p><img data-src="/assets/img/20220317074417.png" alt="" data-proofer-ignore></p>

<p>I modified this code in an attempt to see when it’s being used, but that didn’t work. So I just moved on.</p>

<p><br /></p>

<hr />
<h3 id="apk-reversing">APK Reversing<a href="#apk-reversing" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p>The homepage of the main site links to an APK file at <code class="language-plaintext highlighter-rouge">/catchv1.0.apk</code>. I checked for other APK files that may exist on the server by bruteforcing the version number, but none was found.</p>

<p>I used <code class="language-plaintext highlighter-rouge">apktool</code> to unpack the APK file, which will give me the decoded resources used by the app, but the code will all be in <code class="language-plaintext highlighter-rouge">.smali</code>;</p>

<p><img data-src="/assets/img/20220317075305.png" alt="" data-proofer-ignore></p>

<p>Using <code class="language-plaintext highlighter-rouge">unzip</code>, I extracted the APK file to obtain the <code class="language-plaintext highlighter-rouge">.dex</code> file;</p>

<p><img data-src="/assets/img/20220317075454.png" alt="" data-proofer-ignore></p>

<p>Using <code class="language-plaintext highlighter-rouge">dex2jar</code>, I converted the <code class="language-plaintext highlighter-rouge">.dex</code> file into <code class="language-plaintext highlighter-rouge">.jar</code>, and decompiled it using <code class="language-plaintext highlighter-rouge">cfr</code>;</p>

<p><img data-src="/assets/img/20220317075623.png" alt="" data-proofer-ignore>
<img data-src="/assets/img/20220317075907.png" alt="" data-proofer-ignore></p>

<p>As per the <em>AndroidManifest.xml</em> fille decoded by <code class="language-plaintext highlighter-rouge">apktool</code>, the class <code class="language-plaintext highlighter-rouge">com.example.acatch.MainActivity</code> is the main activity of the application, which is the class that will be called when the application is launched;</p>

<p><img data-src="/assets/img/20220317080133.png" alt="" data-proofer-ignore></p>

<p>The application appears to be an android webview application, which is a technology used by android apps that make them act like browsers for accessing websites. Looking through the code, a HTTPs URL was found;</p>

<p><img data-src="/assets/img/20220317080453.png" alt="" data-proofer-ignore></p>

<p>This doesn’t make sense because port <strong>443</strong> is not open on the server;</p>

<p><img data-src="/assets/img/20220317080601.png" alt="" data-proofer-ignore></p>

<p>Going to the subdomain over HTTP also showed the exact same homepage.</p>

<p>I made a mistake at this stage of the box and just ignored the APK, since the main class doesn’t appear to be doing anything more than viewing that URL, which isn’t even valid. As it turns out, there are some very interesting entries in the XML file <code class="language-plaintext highlighter-rouge">res/values/strings.xml</code>, which is used by android to define strings in key-value mappings that make it easy to reuse data throughout the application. Going through the file, I found some very interesting entries;</p>

<p><img data-src="/assets/img/20220317081525.png" alt="" data-proofer-ignore></p>

<p>The token for <em>Gitea</em> just didn’t work, so I’m guessing it had been revoked. The token for <em>Let’s Chat</em> is a base64 string, so I decoded it, which gave me <code class="language-plaintext highlighter-rouge">61b86aead984e2451036eb16:d588468ff8bae446379a57fa2b4e63a2368224336b5949c5</code>. This sort of token format is usually used in HTTP <em>Authorization: bearer</em> header, which contains the username and password separated by a colon. Testing the values as username and password in the login form of <em>Let’s Chat</em> didn’t work. So I tried passing the token in the <em>authorization</em> header, and it appeared to work, but just hanged;</p>

<p><img data-src="/assets/img/20220317082420.png" alt="" data-proofer-ignore></p>

<p>Viewing the source code of the page, the authentication appeared to have worked;</p>

<p><img data-src="/assets/img/20220317082543.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="lets-chat-1">Let’s Chat<a href="#lets-chat-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p>Let’s Chat has a powerful API, and it’s documentation is available at https://github.com/sdelements/lets-chat/wiki/API. With the help of the guide, I was able to enumerate valid users;</p>

<p><img data-src="/assets/img/20220317083058.png" alt="" data-proofer-ignore></p>

<p>This gave me four usernames: <code class="language-plaintext highlighter-rouge">admin</code>, <code class="language-plaintext highlighter-rouge">john</code>, <code class="language-plaintext highlighter-rouge">will</code>, and <code class="language-plaintext highlighter-rouge">lucas</code>. There are 3 rooms in the chat service, none of which are password-protected;</p>

<div class="language-json highlighter-rouge"><div class="code-header"><span label-text="JSON"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"slug"</span><span class="p">:</span><span class="w"> </span><span class="s2">"status"</span><span class="p">,</span><span class="w">                                                                                                                 
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Status"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cachet Updates and Maintenance"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lastActive"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-14T10:34:20.749Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-14T10:00:08.384Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"hasPassword"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"participants"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61b8708efe190b466d476bfb"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"slug"</span><span class="p">:</span><span class="w"> </span><span class="s2">"android_dev"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Android Development"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Android App Updates, Issues &amp; More"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lastActive"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-14T10:24:21.145Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-14T10:23:10.474Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">                                                                                                                 
    </span><span class="nl">"hasPassword"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">                                                                                                             
    </span><span class="nl">"participants"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">                                   
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61b86b3fd984e2451036eb18"</span><span class="p">,</span><span class="w">                    
    </span><span class="nl">"slug"</span><span class="p">:</span><span class="w"> </span><span class="s2">"employees"</span><span class="p">,</span><span class="w">                               
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Employees"</span><span class="p">,</span><span class="w">                 
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New Joinees, Org updates"</span><span class="p">,</span><span class="w">       
    </span><span class="nl">"lastActive"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-14T10:18:04.710Z"</span><span class="p">,</span><span class="w">             
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-14T10:00:31.043Z"</span><span class="p">,</span><span class="w">                                                                                            
    </span><span class="nl">"owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w"> 
    </span><span class="nl">"private"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"hasPassword"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"participants"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Dumping the messages in the first channel gave a credential;</p>

<p><img data-src="/assets/img/20220317083810.png" alt="" data-proofer-ignore></p>

<p>Trying this credential in the login page of Cachet instance at <code class="language-plaintext highlighter-rouge">http://catch.htb:8000/auth/login</code>, I was able to log in;</p>

<p><img data-src="/assets/img/20220317083941.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="cachet-1">Cachet<a href="#cachet-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p><em>Cachet</em> has a few vulnerabilities, which are well explained in the blog post https://blog.sonarsource.com/cachet-code-execution-via-laravel-configuration-injection. The newline injection vulnerability in the web app immediately caught my attention, as it can be used to override the parameters defined in the configuration file, which is in <code class="language-plaintext highlighter-rouge">.env</code>. Going through the file, the parameter <code class="language-plaintext highlighter-rouge">DB_HOST</code> looks interesting as it defined the address of the backend database to use, which by default is MySQL.</p>

<p>The newline injection can be triggered when updating the <em>mail</em> settings according to the article;</p>

<p><img data-src="/assets/img/20220317084828.png" alt="" data-proofer-ignore></p>

<p>Here is a sample of the configuration file;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>APP_ENV=production
APP_DEBUG=false
APP_URL=http://localhost
APP_KEY=SomeRandomString

DB_DRIVER=mysql
DB_HOST=localhost
DB_DATABASE=cachet
DB_USERNAME=homestead
DB_PASSWORD=secret
DB_PORT=null
DB_PREFIX=null

CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_DRIVER=sync
CACHET_EMOJI=false

MAIL_DRIVER=smtp
MAIL_HOST=mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ADDRESS=null
MAIL_NAME=null
MAIL_ENCRYPTION=tls
---[snip]---
</pre></td></tr></tbody></table></code></div></div>

<p>Doing a normal update generated the following request;</p>

<p><img data-src="/assets/img/20220317085558.png" alt="" data-proofer-ignore></p>

<p>Notice how the parameter names are all submitted in the request as some sort of index key inside the variable <code class="language-plaintext highlighter-rouge">config</code>. This hints at a possible <em>mass assignment</em> vulnerability. So I changed the <code class="language-plaintext highlighter-rouge">config[mail_host]</code> submitted in the request to <code class="language-plaintext highlighter-rouge">config[db_host]</code> and set the value to my IP, then start up metasploit and used the module <code class="language-plaintext highlighter-rouge">auxiliary/server/capture/mysql</code> to capture MySQL handshake, and it worked;</p>

<p><img data-src="/assets/img/20220317090459.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/20220317090615.png" alt="" data-proofer-ignore></p>

<p>Forwarding the request, metasploit captured a challenge for the user <code class="language-plaintext highlighter-rouge">will</code>;</p>

<p><img data-src="/assets/img/20220317090803.png" alt="" data-proofer-ignore></p>

<p>To my surprise, <code class="language-plaintext highlighter-rouge">john</code> was unable to crack the hash using <code class="language-plaintext highlighter-rouge">rockyou.txt</code>, which is the standard for HTB boxes when it comes to crackable passwords;</p>

<p><img data-src="/assets/img/20220317091207.png" alt="" data-proofer-ignore></p>

<p>Looking further into the article mentioned above, I learned that <em>Cachet</em> is also vulnerable to configuration leaks. This happens when you supply a parameter name wrapped in <code class="language-plaintext highlighter-rouge">${}</code>, like <code class="language-plaintext highlighter-rouge">${DB_HOST}</code>. Using this, I was able to leak the plain MySQL password by setting the value of the <code class="language-plaintext highlighter-rouge">Mail From Address</code> field to <code class="language-plaintext highlighter-rouge">${DB_PASSWORD}</code>, submitting the request, and reloading the page;</p>

<p><img data-src="/assets/img/20220317092034.png" alt="" data-proofer-ignore></p>

<p>This gave me the password;</p>

<p><img data-src="/assets/img/20220317092131.png" alt="" data-proofer-ignore></p>

<p>Since metasploit earlier told me the database user is <code class="language-plaintext highlighter-rouge">will</code>, I tested the credential on the SSH service running on the host, and I was able to login;</p>

<p><img data-src="/assets/img/20220317210917.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="privesc">Privesc<a href="#privesc" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p>No sudo permission is available for the user <strong>will</strong>. Running LinPEAS also didn’t show anything very interesting at a quick glance. Running <code class="language-plaintext highlighter-rouge">pspy</code> on the host showed something;</p>

<p><img data-src="/assets/img/20220318062906.png" alt="" data-proofer-ignore></p>

<p>Going to the <code class="language-plaintext highlighter-rouge">/opt/mdm</code> directory, I found the shell script that’s being run as root;</p>

<div class="language-bash highlighter-rouge"><div class="code-header"><span label-text="Shell"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c">###################</span>
<span class="c"># Signature Check #</span>
<span class="c">###################</span>

sig_check<span class="o">()</span> <span class="o">{</span>
        jarsigner <span class="nt">-verify</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">/</span><span class="nv">$2</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">&gt;</span>/dev/null
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s1">'[+] Signature Check Passed'</span>
        <span class="k">else
                </span><span class="nb">echo</span> <span class="s1">'[!] Signature Check Failed. Invalid Certificate.'</span>
                cleanup
                <span class="nb">exit
        </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c">#######################</span>
<span class="c"># Compatibility Check #</span>
<span class="c">#######################</span>

comp_check<span class="o">()</span> <span class="o">{</span>
        apktool d <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">/</span><span class="nv">$2</span><span class="s2">"</span> <span class="nt">-o</span> <span class="nv">$3</span> 2&gt;/dev/null <span class="o">&gt;</span>/dev/null
        <span class="nv">COMPILE_SDK_VER</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-oPm1</span> <span class="s2">"(?&lt;=compileSdkVersion=</span><span class="se">\"</span><span class="s2">)[^</span><span class="se">\"</span><span class="s2">]+"</span> <span class="s2">"</span><span class="nv">$PROCESS_BIN</span><span class="s2">/AndroidManifest.xml"</span><span class="si">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$COMPILE_SDK_VER</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s1">'[!] Failed to find target SDK version.'</span>
                cleanup
                <span class="nb">exit
        </span><span class="k">else
                if</span> <span class="o">[</span> <span class="nv">$COMPILE_SDK_VER</span> <span class="nt">-lt</span> 18 <span class="o">]</span><span class="p">;</span> <span class="k">then
                        </span><span class="nb">echo</span> <span class="s2">"[!] APK Doesn't meet the requirements"</span>
                        cleanup
                        <span class="nb">exit
                </span><span class="k">fi
        fi</span>
<span class="o">}</span>

<span class="c">####################</span>
<span class="c"># Basic App Checks #</span>
<span class="c">####################</span>

app_check<span class="o">()</span> <span class="o">{</span>
        <span class="nv">APP_NAME</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-oPm1</span> <span class="s2">"(?&lt;=&lt;string name=</span><span class="se">\"</span><span class="s2">app_name</span><span class="se">\"</span><span class="s2">&gt;)[^&lt;]+"</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">/res/values/strings.xml"</span><span class="si">)</span>
        <span class="nb">echo</span> <span class="nv">$APP_NAME</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$APP_NAME</span> <span class="o">==</span> <span class="k">*</span><span class="s2">"Catch"</span><span class="k">*</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$APP_NAME</span>|xargs <span class="nt">-I</span> <span class="o">{}</span> sh <span class="nt">-c</span> <span class="s1">'mkdir {}'</span>
                <span class="nb">mv</span> <span class="s2">"</span><span class="nv">$3</span><span class="s2">/</span><span class="nv">$APK_NAME</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">/</span><span class="nv">$APP_NAME</span><span class="s2">/</span><span class="nv">$4</span><span class="s2">"</span>
        <span class="k">else
                </span><span class="nb">echo</span> <span class="s2">"[!] App doesn't belong to Catch Global"</span>
                cleanup
                <span class="nb">exit
        </span><span class="k">fi</span>
<span class="o">}</span>


<span class="c">###########</span>
<span class="c"># Cleanup #</span>
<span class="c">###########</span>

cleanup<span class="o">()</span> <span class="o">{</span>
        <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$PROCESS_BIN</span><span class="p">;</span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="s2">"</span><span class="nv">$DROPBOX</span><span class="s2">/*"</span> <span class="s2">"</span><span class="nv">$IN_FOLDER</span><span class="s2">/*"</span><span class="p">;</span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="si">$(</span><span class="nb">ls</span> <span class="nt">-A</span> /opt/mdm | <span class="nb">grep</span> <span class="nt">-v</span> apk_bin | <span class="nb">grep</span> <span class="nt">-v</span> verify.sh<span class="si">)</span>
<span class="o">}</span>


<span class="c">###################</span>
<span class="c"># MDM CheckerV1.0 #</span>
<span class="c">###################</span>

<span class="nv">DROPBOX</span><span class="o">=</span>/opt/mdm/apk_bin
<span class="nv">IN_FOLDER</span><span class="o">=</span>/root/mdm/apk_bin
<span class="nv">OUT_FOLDER</span><span class="o">=</span>/root/mdm/certified_apps
<span class="nv">PROCESS_BIN</span><span class="o">=</span>/root/mdm/process_bin

<span class="k">for </span>IN_APK_NAME <span class="k">in</span> <span class="nv">$DROPBOX</span>/<span class="k">*</span>.apk<span class="p">;</span><span class="k">do
        </span><span class="nv">OUT_APK_NAME</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">IN_APK_NAME</span><span class="p">##*/</span><span class="k">}</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'.'</span> <span class="nt">-f1</span><span class="si">)</span><span class="s2">_verified.apk"</span>
        <span class="nv">APK_NAME</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>openssl rand <span class="nt">-hex</span> 12<span class="si">)</span><span class="s2">.apk"</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nt">-L</span> <span class="s2">"</span><span class="nv">$IN_APK_NAME</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">exit
        </span><span class="k">else
                </span><span class="nb">mv</span> <span class="s2">"</span><span class="nv">$IN_APK_NAME</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$IN_FOLDER</span><span class="s2">/</span><span class="nv">$APK_NAME</span><span class="s2">"</span>
        <span class="k">fi
        </span>sig_check <span class="nv">$IN_FOLDER</span> <span class="nv">$APK_NAME</span>
        comp_check <span class="nv">$IN_FOLDER</span> <span class="nv">$APK_NAME</span> <span class="nv">$PROCESS_BIN</span>
        app_check <span class="nv">$PROCESS_BIN</span> <span class="nv">$OUT_FOLDER</span> <span class="nv">$IN_FOLDER</span> <span class="nv">$OUT_APK_NAME</span>
<span class="k">done
</span>cleanup

</pre></td></tr></tbody></table></code></div></div>

<p>After studying the code for a while, I undertood what it does;</p>

<ol>
  <li>Loop over all apk files in the directory <code class="language-plaintext highlighter-rouge">$DROPBOX</code> point to, which is <code class="language-plaintext highlighter-rouge">/opt/mdm/apk_bin</code>. We have write access to this directory.</li>
  <li>Obtain the filename, and remove the <code class="language-plaintext highlighter-rouge">.apk</code> extension in the filename and append <code class="language-plaintext highlighter-rouge">_verified.apk</code></li>
  <li>Generate a 24 character long hex string, which the APK file will be renamed to in the <code class="language-plaintext highlighter-rouge">$DROPBOX</code> directory.</li>
  <li>Verify if the APK is signed  by calling <code class="language-plaintext highlighter-rouge">sig_check()</code>, which uses <code class="language-plaintext highlighter-rouge">jarsigner -verify &lt;apk-file&gt;</code>, and check if the exit code is 0. I doubt we need to worry about this because testing <code class="language-plaintext highlighter-rouge">jarsigner -verify</code> on my machine, even on unsigned APK file, exited with <code class="language-plaintext highlighter-rouge">0</code> exit code, which is what the script is looking for.</li>
  <li>Call <code class="language-plaintext highlighter-rouge">comp_check()</code>, which decompile the APK file using <code class="language-plaintext highlighter-rouge">apktool</code>, and check if the <code class="language-plaintext highlighter-rouge">compileSdkVersion</code> defined in the android manifest is at least <strong>18</strong> using <code class="language-plaintext highlighter-rouge">grep</code>.</li>
  <li>Call <code class="language-plaintext highlighter-rouge">app_check()</code>, which extract the name of the app from <code class="language-plaintext highlighter-rouge">res/values/strings.xml</code> using the key <code class="language-plaintext highlighter-rouge">app_name</code>, ensure that it contains the string <code class="language-plaintext highlighter-rouge">Catch</code>, and pass it in an unsafe way to a shell command that create directory using <code class="language-plaintext highlighter-rouge">mkdir + &lt;app_name&gt;</code>.</li>
</ol>

<p>After some local testing, step <strong>6</strong> appears to be exploitable if we can inject a command in the name of the app we drop into the <code class="language-plaintext highlighter-rouge">/opt/mdm/apk_bin</code> directory. My first attempt was to do this using <code class="language-plaintext highlighter-rouge">apktool</code>. I used the <em>catchv1.0.apk</em> app downloaded earlier from the site. For some reasons, <code class="language-plaintext highlighter-rouge">apktool</code> is unable to compile the decompiled and modified APK, so I started looking for other alternatives.</p>

<p>Since this is a very simple change, as we are only modifying the name of the app, I started looking for android apps that could get the job done, and I found a great one named <strong>APK Editor Pro</strong>. So installed it, and did it on android by;</p>
<ol>
  <li>Loading the apk file</li>
  <li>Selecting the “Full Edit” option</li>
  <li>Selecting the “Decode All Files” option</li>
  <li>Moving to the “Files” tab</li>
  <li>Opening <code class="language-plaintext highlighter-rouge">res/values/strings.xml</code></li>
  <li>Changing line <strong>30</strong> from <code class="language-plaintext highlighter-rouge">&lt;string name="app_name"&gt;Catch&lt;/string&gt;</code> to <code class="language-plaintext highlighter-rouge">&lt;string name="app_name"&gt;Catch; /dev/shm/payload&lt;/string&gt;</code></li>
</ol>

<p>I then rebuit the apk, which saved it as <code class="language-plaintext highlighter-rouge">gen_signed.apk</code>. I copied it over to the web directory on my attack box, and created a file named <code class="language-plaintext highlighter-rouge">payload</code> with my reverse shell. I chose this approach to avoid having characters in the name of the app that may not be allowed.</p>

<p>I SSHed back into the box as <strong>will</strong>, and download the <code class="language-plaintext highlighter-rouge">gen_signed.apk</code> and <code class="language-plaintext highlighter-rouge">payload</code> file to <code class="language-plaintext highlighter-rouge">/dev/shm</code>. I made the payload executable, and moved the APK to <code class="language-plaintext highlighter-rouge">/opt/mdm/apk_bin</code>, and waited for the cron task to process it;</p>

<p><img data-src="/assets/img/20220318065817.png" alt="" data-proofer-ignore></p>

<p>After a few seconds, my malicious APK file was processed, and I got a reverse shell on the box as root;</p>

<p><img data-src="/assets/img/20220318065833.png" alt="" data-proofer-ignore></p>

<p><br /></p>

<hr />
<h3 id="summary">Summary<a href="#summary" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<ul>
  <li>Identified port <strong>22</strong>, <strong>80</strong>, <strong>3000</strong> (Gitea), <strong>5000</strong> (Let’s Chat), and <strong>8000</strong> (Cachet) using <code class="language-plaintext highlighter-rouge">nmap</code></li>
  <li>Reversed the APK file obtained from the main site, and recovered some tokens.</li>
  <li>One of the tokens gave access to the API of <em>Let’s Chat</em>
    <ul>
      <li>Chat logs obtained using the API revealed a credential for <strong>john</strong></li>
      <li>This credential is reused on the <em>Cachet</em> instance.</li>
    </ul>
  </li>
  <li>Inside <em>Cachet</em> as <strong>john</strong>
    <ul>
      <li>Exploited a <em>mass assignment</em> vulnerability to hijack backend MySQL server used, and capture handshake using <em>metasploit’s</em> <code class="language-plaintext highlighter-rouge">auxiliary/server/capture/mysql</code>. The handshake could not be cracked using <code class="language-plaintext highlighter-rouge">rockyou.txt</code></li>
      <li>Exploited a configuration leak to obtain the plaintext password of the MySQL backend, which gave me access to the box as user <strong>will</strong> over SSH.</li>
    </ul>
  </li>
  <li>Inside the box as <strong>will</strong>
    <ul>
      <li>Identified a cron task running as root that calls <code class="language-plaintext highlighter-rouge">/opt/mdm/verify.sh</code></li>
      <li>This script process APK files in a directory we can write to.</li>
      <li>Studied the code, and built a malicious APK file that exploited a <em>command injection</em> vulnerability in how the name of the app as defined in <code class="language-plaintext highlighter-rouge">res/values/strings.xml</code> is processed, which gave me access to the box as <strong>root</strong></li>
    </ul>
  </li>
</ul>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories --><div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i><a href='/categories/hackthebox/'>hackthebox</a></div><!-- tags --><div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i><a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >hackthebox</a><a href="/tags/linux/"
          class="post-tag no-text-decoration" >linux</a><a href="/tags/web/"
          class="post-tag no-text-decoration" >web</a><a href="/tags/api/"
          class="post-tag no-text-decoration" >api</a><a href="/tags/git/"
          class="post-tag no-text-decoration" >git</a><a href="/tags/gitea/"
          class="post-tag no-text-decoration" >gitea</a><a href="/tags/cachet/"
          class="post-tag no-text-decoration" >cachet</a><a href="/tags/android/"
          class="post-tag no-text-decoration" >android</a><a href="/tags/apktool/"
          class="post-tag no-text-decoration" >apktool</a><a href="/tags/reverse-engineering/"
          class="post-tag no-text-decoration" >reverse engineering</a><a href="/tags/custom-exploitation/"
          class="post-tag no-text-decoration" >custom exploitation</a><a href="/tags/cron/"
          class="post-tag no-text-decoration" >cron</a><a href="/tags/password-reuse/"
          class="post-tag no-text-decoration" >password reuse</a></div><div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a> by the author.</div><!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons"><a href="https://twitter.com/intent/tweet?text=Catch - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/catch.html" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a><a href="https://www.facebook.com/sharer/sharer.php?title=Catch - HackTheBox - 4g3nt47&u=https://4g3nt47.github.io/posts/hackthebox/catch.html" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a><a href="https://telegram.me/share?text=Catch - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/catch.html" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a><i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span>
</div>
</div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

</div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

    <div class="access"><!--<div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/sql-injection/">sql injection</a><a class="post-tag" href="/tags/rce/">rce</a></div>
  </div>-->
    </div><!-- BS-toc.js will be loaded at medium priority -->
<script src="/assets/js/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div></div>

</div>

<!-- tail --><div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  --><!-- An random integer that bigger than 0  --><!-- Equals to TAG_SCORE / {max_categories_hierarchy}  --><!-- Fill with the other newlest posts  --><div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4"><div class="card">
        <a href="/posts/hackthebox/timing.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-06-04 00:00:00 +0100">Jun  4</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Timing - HackTheBox</h3>
            <div class="text-muted small">
              <p>Timing is a very nice medium-rated linux box that involves a bit of static analysis on PHP files. Foothold involves quite a few steps that start with an LFI vulnerability to read source code of the...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/secret.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-03-26 00:00:00 +0100">Mar 26</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Secret - HackTheBox</h3>
            <div class="text-muted small">
              <p>Secret is an easy linux box where you have to exploit a sensitive information leak in a git repo to recover a JWT secret, which allows you to forge a JWT token that gives you access to an API endpo...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/overflow.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-04-09 00:00:00 +0100">Apr  9</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Overflow - HackTheBox</h3>
            <div class="text-muted small">
              <p>Overflow is an amazing hard-rated box on HackTheBox. To gain a foothold on the box, you will need to exploit an oracle padding vulnerability to gain access to an admin dashboard that’s vulnerable t...
              </p>
            </div>
          </div>
        </a>
      </div></div> <!-- .card-deck -->
  </div> <!-- #related-posts --><!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between"><a href="/posts/hackthebox/undetected.html" class="btn btn-outline-primary"
    prompt="Older">
    <p>Undetected - HackTheBox</p>
  </a><span class="btn btn-outline-primary disabled"
    prompt="Newer">
    <p>-</p>
  </span></div>
<!--  The comments switcher --></div>
  </div>
</div> <!-- .row --><!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2022
        <a href="https://twitter.com/UmarAbdoul">Umar Abdul</a>.<span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p>
    </div>

    <div class="footer-right">
      <p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>
</div><!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints"><div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/sql-injection/">sql injection</a><a class="post-tag" href="/tags/rce/">rce</a></div>
  </div></div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>
</div> <!-- #main-wrapper --><div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a><!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
--><script src="/assets/js/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
<!--
  JS selector for site.
-->

<!-- layout specified --><!-- image lazy-loading & popup -->
  <script src="/assets/js/clipboard.min.js"></script><script defer src="/assets/js/dist/post.min.js"></script><!-- commons -->

<script src="/assets/js/bootstrap.min.js"></script></body>

</html>
