<!DOCTYPE html><html lang="en"mode="dark"><!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now"><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Agile - HackTheBox" />
<meta property="og:locale" content="en" />
<meta name="description" content="Agile is a medium linux box by 0xdf featuring a simple web-based LFI that could be used to bypass PIN validation in the Werkzeug debug console. Once on the box, you’ll recover some creds from a MySQL database and gain access to a local user account. You’ll then be required to exploit a previously discovered vulnerability but this time using a local symlink to get through a filter, and then exploit sudoedit and a cron job that uses python’s virtualenv to gain code execution as root." />
<meta property="og:description" content="Agile is a medium linux box by 0xdf featuring a simple web-based LFI that could be used to bypass PIN validation in the Werkzeug debug console. Once on the box, you’ll recover some creds from a MySQL database and gain access to a local user account. You’ll then be required to exploit a previously discovered vulnerability but this time using a local symlink to get through a filter, and then exploit sudoedit and a cron job that uses python’s virtualenv to gain code execution as root." />
<link rel="canonical" href="https://4g3nt47.github.io/posts/hackthebox/agile.html" />
<meta property="og:url" content="https://4g3nt47.github.io/posts/hackthebox/agile.html" />
<meta property="og:site_name" content="4g3nt47" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-05T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Agile - HackTheBox" />
<meta name="twitter:site" content="@UmarAbdoul" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"Agile is a medium linux box by 0xdf featuring a simple web-based LFI that could be used to bypass PIN validation in the Werkzeug debug console. Once on the box, you’ll recover some creds from a MySQL database and gain access to a local user account. You’ll then be required to exploit a previously discovered vulnerability but this time using a local symlink to get through a filter, and then exploit sudoedit and a cron job that uses python’s virtualenv to gain code execution as root.","@type":"BlogPosting","url":"https://4g3nt47.github.io/posts/hackthebox/agile.html","headline":"Agile - HackTheBox","dateModified":"2023-08-05T00:00:00+01:00","datePublished":"2023-08-05T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://4g3nt47.github.io/posts/hackthebox/agile.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>Agile - HackTheBox | 4g3nt47
  </title><!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
--><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="4g3nt47">
<meta name="application-name" content="4g3nt47">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA --><!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/css/all.min.css"><!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet"
    href="/assets/css/bootstrap-toc.min.css"><!-- Manific Popup -->
  <link rel="stylesheet" href="/assets/css/magnific-popup.min.css"><!-- JavaScript -->

  <script src="/assets/js/jquery.min.js"></script>

</head>
<body data-spy="scroll" data-target="#toc"><!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto"><img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"></a>
    </div>

    <div class="site-title mt-3">
      <a href="/">4g3nt47</a>
    </div>
    <div class="site-subtitle font-italic">Welcome to my infosec blog</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs --><li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i><span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i><span>TAGS</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i><span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i><span>ABOUT</span>
      </a>
    </li> <!-- .nav-item --></ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"><a href="https://github.com/4g3nt47" aria-label="github"target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a><a href="https://twitter.com/UmarAbdoul" aria-label="twitter"target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a><a href="javascript:location.href = 'mailto:' + ['aufaruq02','gmail.com'].join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a><a href="/rss/feed.xml" aria-label="rss">
        <i class="fas fa-rss"></i>
      </a></div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->
<!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb"><span>
            <a href="/">
              Home
            </a>
          </span><span>Agile - HackTheBox</span></span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">Post</div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>
<div id="main-wrapper">
      <div id="main">

        <div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
  Refactor the HTML structure.
--><!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
--><!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
--><!-- Add attribute 'hide-bullet' to the checkbox list --><!-- images --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add header for code snippets --><!-- Create heading anchors --><!-- return -->

<h1 data-toc-skip>Agile - HackTheBox</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>By
    <em><a href="https://twitter.com/UmarAbdoul">Umar Abdul</a></em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted<!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeago"
    date="2023-08-05 00:00:00 +0100"data-toggle="tooltip"
      data-placement="bottom"
      title="Sat, Aug  5, 2023, 12:00 AM +0100">Aug  5, 2023</em>
</span>

      <!-- lastmod date --><!-- read time --><!--
  Calculate the post's reading time, and display the word count in tooltip
 --><!-- words per minute  --><!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1937 words">
  <em>10 min</em> read</span>
<!-- page views --></div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p><strong>Agile</strong> is a medium linux box by 0xdf featuring a simple web-based LFI that could be used to bypass PIN validation in the <em>Werkzeug</em> debug console. Once on the box, you’ll recover some creds from a MySQL database and gain access to a local user account. You’ll then be required to exploit a previously discovered vulnerability but this time using a local symlink to get through a filter, and then exploit <code class="language-plaintext highlighter-rouge">sudoedit</code> and a cron job that uses python’s virtualenv to gain code execution as <code class="language-plaintext highlighter-rouge">root</code>.</p>

<p><br /></p>

<h3 id="about">About<a href="#about" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p><img data-src="/assets/img/Pasted image 20230324102949.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230324103020.png" alt="" data-proofer-ignore></p>

<hr />
<p><br /></p>

<h3 id="recon">Recon<a href="#recon" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="nmap">NMAP<a href="#nmap" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre># Nmap 7.70 scan initiated Wed Mar 15 06:47:26 2023 as: nmap -sC -sV -oN nmap.txt -v 10.10.11.203
Nmap scan report for agile (10.10.11.203)
Host is up (0.44s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://superpass.htb
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Mar 15 06:48:32 2023 -- 1 IP address (1 host up) scanned in 66.77 seconds
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h4 id="web">Web<a href="#web" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>Going to the web page redirected to <code class="language-plaintext highlighter-rouge">superpass.htb</code>, which I then added to my <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file;</p>

<p><img data-src="/assets/img/Pasted image 20230324103938.png" alt="" data-proofer-ignore></p>

<p>There is a <em>getting started</em> link at the bottom of the page, which redirect to a login form;</p>

<p><img data-src="/assets/img/Pasted image 20230324104049.png" alt="" data-proofer-ignore></p>

<p>Clicking the <em>register</em> button, I was able to create an account, and login;</p>

<p><img data-src="/assets/img/Pasted image 20230324104254.png" alt="" data-proofer-ignore></p>

<p>The application is a custom web-based password manager. Checking <em>burp</em>, the application issued us with a token following login;</p>

<div class="language-text highlighter-rouge"><div class="code-header"><span label-text="Text"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>session=.eJwtjkuKwzAQRK8ieh0GtSRLap8i-yGEltQdG5wPlrMKuftoMauiqOLxPnDVjfsiHebfD5hjBNyld74JnOC8CXcx2_Nm1oc5noZrHaM5lrWb1_j8wOV7OQ3ILn2B-djfMtraYAas2VEkLllTLmhLyMlHL7lZVGIqNgVN0-QImwRfGjYUVinqY_UanNQYAmkNwgOktobJZVsc-ZgjVXLosXkXlDG1zIVIHDvbkFOzqQz967vL_m-T4PsHJgRGWg.ZB1wLQ.O5sxCFDdi0TGl0bQOQvJrPSjISE
</pre></td></tr></tbody></table></code></div></div>

<p>That looked a bit like a JWT, but the algorithm part is missing. Attempting to base64-decode the payload part of the token failed, likely due to the the <code class="language-plaintext highlighter-rouge">-</code> and <code class="language-plaintext highlighter-rouge">_</code> symbols in the payload. Some encoders replace <code class="language-plaintext highlighter-rouge">+</code> and <code class="language-plaintext highlighter-rouge">/</code> with <code class="language-plaintext highlighter-rouge">-</code> and <code class="language-plaintext highlighter-rouge">_</code>, respectively. After replacing them, the payload decodes to a zlib-compressed data, which decompresses to a JSON object;</p>

<div class="language-json highlighter-rouge"><div class="code-header"><span label-text="JSON"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"_flashes"</span><span class="p">:[{</span><span class="nl">" t"</span><span class="p">:[</span><span class="s2">"message"</span><span class="p">,</span><span class="s2">"Please log in to access this page."</span><span class="p">]}],</span><span class="nl">"_fresh"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"_id"</span><span class="p">:</span><span class="s2">"1c82969ab8f78b10b487363e8d01f9a9b074f755291de43bd1d1eafebf36c3f42ec6449fc4ea296f0c45280b2936869c92131d324fa17d8ab99e2a20d1a7d07b"</span><span class="p">,</span><span class="nl">"_user_id"</span><span class="p">:</span><span class="s2">"17"</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>So I wrote a simple script that, when given a token payload as an argument, decodes it, and when given a file, reads it as JSON and encode it;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">zlib</span><span class="p">,</span> <span class="n">base64</span>

<span class="k">def</span> <span class="nf">token_decode</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
  <span class="n">token</span> <span class="o">=</span> <span class="n">token</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"-"</span><span class="p">,</span> <span class="s">"+"</span><span class="p">)</span>
  <span class="n">token</span> <span class="o">=</span> <span class="n">token</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"_"</span><span class="p">,</span> <span class="s">"/"</span><span class="p">)</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">token</span> <span class="o">+=</span> <span class="s">"="</span>
  <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] Base64: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="p">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">wfo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"token_data.json"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span>
  <span class="n">wfo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">wfo</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
  <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] JSON: </span><span class="si">{</span><span class="n">data</span><span class="p">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">token_encode</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">zlib</span><span class="p">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">encode</span><span class="p">())).</span><span class="n">decode</span><span class="p">()</span>
  <span class="k">while</span> <span class="n">data</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">"="</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"+"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="s">"_"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] Token: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">data</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
  <span class="n">token</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">token</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
    <span class="n">token_encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">token_decode</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Multiple attempts to manipulate the token using this script failed, so I moved on.</p>

<p>The password manager has an option to <em>export</em> passwords in the vault, which generated a CSV file of passwords for download;</p>

<p><img data-src="/assets/img/Pasted image 20230324105930.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230324110102.png" alt="" data-proofer-ignore></p>

<p>The <code class="language-plaintext highlighter-rouge">fn</code> parameter looks interesting. Testing it, it was found to be vulnerable to <em>Local File Inclusion (LFI)</em>;</p>

<p><img data-src="/assets/img/Pasted image 20230324110256.png" alt="" data-proofer-ignore></p>

<p>Giving the parameter an invalid file generated a detailed debug message that exposes the web app as a <em>Flask/Werkzeug</em> application. This indicate the server is running in debug mode. Going to the <code class="language-plaintext highlighter-rouge">/console</code> route (the default debug console route for Flask) however gave a <strong>404</strong> message;</p>

<p><img data-src="/assets/img/Pasted image 20230324110755.png" alt="" data-proofer-ignore></p>

<p>This is odd since the <strong>404</strong> page returned above differs with the ones returned by the server when requesting an invalid route;</p>

<p><img data-src="/assets/img/Pasted image 20230324110905.png" alt="" data-proofer-ignore></p>

<p>Hovering over a line in the debug error output showed a small terminal icon to the right;</p>

<p><img data-src="/assets/img/Pasted image 20230324111006.png" alt="" data-proofer-ignore></p>

<p>Clicking it prompted us for a debug pin, which we don’t have;</p>

<p><img data-src="/assets/img/Pasted image 20230324111020.png" alt="" data-proofer-ignore></p>

<hr />
<p><br /></p>

<h3 id="foothold">Foothold<a href="#foothold" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<h4 id="enumeration-using-lfi">Enumeration using LFI<a href="#enumeration-using-lfi" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>Taking advantage of the LFI bug, and the debug error output, I was able to extract a lot from the system;</p>
<ul>
  <li><strong>4</strong> local users (<code class="language-plaintext highlighter-rouge">/etc/passwd</code>) - <em>corum</em>, <em>runner</em>, <em>edwards</em>, <em>dev_admin</em></li>
  <li>Hidden subdomain <code class="language-plaintext highlighter-rouge">test.superpass.htb</code> (<code class="language-plaintext highlighter-rouge">/etc/hosts</code>). Can’t access this domain from my box as it keeps redirecting to <code class="language-plaintext highlighter-rouge">superpass.htb</code>.</li>
  <li>Process command (<code class="language-plaintext highlighter-rouge">/proc/self/cmdline</code>) - <code class="language-plaintext highlighter-rouge">/app/venv/bin/python3/app/venv/bin/gunicorn--bind127.0.0.1:5000--threads=10--timeout600wsgi:app</code></li>
  <li>Environment vars (<code class="language-plaintext highlighter-rouge">/proc/self/environ</code>) - <code class="language-plaintext highlighter-rouge">LANG=C.UTF-8PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/binHOME=/var/wwwLOGNAME=www-dataUSER=www-dataINVOCATION_ID=9c2427940e444f78a89d7d86fde2dc58JOURNAL_STREAM=8:32855SYSTEMD_EXEC_PID=1090CONFIG_PATH=/app/config_prod.json</code>
    <ul>
      <li>MySQL creds in <code class="language-plaintext highlighter-rouge">/app/config_prod.json</code> - <code class="language-plaintext highlighter-rouge">superpassuser:dSA6l7q*yIVs$39Ml6ywvgK</code></li>
    </ul>
  </li>
  <li>Application entrypoint:  <code class="language-plaintext highlighter-rouge">/app/app/superpass/app.py</code>
    <ul>
      <li>From there traced all different parts of the app, and downloaded them for analysis.</li>
    </ul>
  </li>
</ul>

<p>The code responsible for the export and the LFI was found in <code class="language-plaintext highlighter-rouge">views/vault_views.py</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230324112717.png" alt="" data-proofer-ignore></p>

<p>The <code class="language-plaintext highlighter-rouge">generate_csv()</code> function is defined in <code class="language-plaintext highlighter-rouge">services/password_service.py</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230324112931.png" alt="" data-proofer-ignore></p>

<p>I thought of finding a way to access other users password exports if I could figure out how the random string appended to the exported filename is generated. The <code class="language-plaintext highlighter-rouge">get_random()</code> function used is defined in <code class="language-plaintext highlighter-rouge">services/utility_service.py</code>;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="n">chars</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()).</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s">"SeCReT?!"</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="n">chars</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></div></div>

<p>It looks pretty solid, so I moved on.</p>

<p><br /></p>

<h4 id="werkzeug-debug-console-pin">Werkzeug Debug Console PIN<a href="#werkzeug-debug-console-pin" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>Looking for possible ways to guess the console PIN, I found <a href="https://github.com/wdahlenburg/werkzeug-debug-console-bypass">this guide</a>. The README explains in great detail how to effectively guess the console PIN of a <em>Werkzeug</em> server provided you have an LFI on the host. I was able to get it to work after some tweaks.</p>

<p>The file <code class="language-plaintext highlighter-rouge">werkzeug-pin-bypass.py</code> has two arrays that need to be configured according to the target;</p>

<p><img data-src="/assets/img/Pasted image 20230324114021.png" alt="" data-proofer-ignore></p>

<p><code class="language-plaintext highlighter-rouge">probably_public_bits</code>;</p>
<ul>
  <li>The username is <code class="language-plaintext highlighter-rouge">www-data</code> in our case.</li>
  <li>The third item set to <code class="language-plaintext highlighter-rouge">Flask</code> is <code class="language-plaintext highlighter-rouge">wsgi_app</code> in our case. I found this by running the given command <code class="language-plaintext highlighter-rouge">getattr(app, '__name__', getattr(app.__class__, '__name__'))</code> in a local instance of the web app. This seems to be the combination of the entrypoint file used by <code class="language-plaintext highlighter-rouge">gunicorn</code> (<code class="language-plaintext highlighter-rouge">wsgi.py</code>) and the web app entrypoint (<code class="language-plaintext highlighter-rouge">app.py</code>).</li>
  <li>Full path of Flask library - <code class="language-plaintext highlighter-rouge">/app/venv/lib/python3.10/site-packages/flask/app.py</code></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">private_bits</code>;</p>
<ul>
  <li>Can’t run <code class="language-plaintext highlighter-rouge">uuid.getnode()</code> on the box obviously, and <code class="language-plaintext highlighter-rouge">/sys/class/net/ens33/address</code> does not exist. I read <code class="language-plaintext highlighter-rouge">/proc/self/net/addr</code> to get the interface the service is using, which was found to be <code class="language-plaintext highlighter-rouge">eth0</code>. Then I read <code class="language-plaintext highlighter-rouge">/sys/class/net/eth0/address</code> to get the address, which I converted to int. This value seems to have changed from when I first did the box, so you may need to regenerate.</li>
  <li>Looking at the other code given for generating machine ID, for this box it will be contents of <code class="language-plaintext highlighter-rouge">/etc/machine-id</code> + <code class="language-plaintext highlighter-rouge">superpass.service</code> (from <code class="language-plaintext highlighter-rouge">/proc/self/cgroup</code>). This turn out to be <code class="language-plaintext highlighter-rouge">ed5b159560f54721827644bc9b220d00superpass.service</code></li>
</ul>

<p>Plugging all these parameters in, we got a PIN;</p>

<p><img data-src="/assets/img/Pasted image 20230324120542.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230324120611.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230324120640.png" alt="" data-proofer-ignore></p>

<p>Running the script gave me a PIN, and it was accepted by the server. I then used the python console to spawn a BASH reverse shell;</p>

<p><img data-src="/assets/img/Pasted image 20230324120804.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230324121106.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230324121122.png" alt="" data-proofer-ignore></p>

<hr />
<p><br /></p>

<h3 id="user">User<a href="#user" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p>With a shell on the box as <code class="language-plaintext highlighter-rouge">www-data</code>, I can now connect to the local MySQL server whose creds I got earlier;</p>

<p><img data-src="/assets/img/Pasted image 20230324121353.png" alt="" data-proofer-ignore></p>

<p>The password in the <code class="language-plaintext highlighter-rouge">users</code> table are all hashed, but the ones in <code class="language-plaintext highlighter-rouge">passwords</code> table are plain;</p>

<p><img data-src="/assets/img/Pasted image 20230324121526.png" alt="" data-proofer-ignore></p>

<p>The creds of <code class="language-plaintext highlighter-rouge">corum</code> are of interest as that’s a valid local user. Testing them, I got access to the local user account of <code class="language-plaintext highlighter-rouge">corum</code> over SSH using the password <code class="language-plaintext highlighter-rouge">5db7caa1d13cc37c9fc2</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230324121718.png" alt="" data-proofer-ignore></p>

<hr />
<p><br /></p>

<h3 id="privesc">PrivEsc<a href="#privesc" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<p>User has no special groups, nor sudo perms. Checking the <em>nginx</em> config files for the server at <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/</code>, I understood why we couldn’t access <code class="language-plaintext highlighter-rouge">/console</code> directly;</p>

<p><img data-src="/assets/img/Pasted image 20230324122202.png" alt="" data-proofer-ignore></p>

<p>The config for the vhost <code class="language-plaintext highlighter-rouge">test.superpass.nginx</code> is defined in <code class="language-plaintext highlighter-rouge">superpass-test.nginx</code>. The service is listening on port <code class="language-plaintext highlighter-rouge">5555</code> locally;</p>

<div class="language-json highlighter-rouge"><div class="code-header"><span label-text="JSON"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="err">server</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">listen</span><span class="w"> </span><span class="mf">127.0</span><span class="err">.</span><span class="mf">0.1</span><span class="err">:</span><span class="mi">80</span><span class="err">;</span><span class="w">
    </span><span class="err">server_name</span><span class="w"> </span><span class="err">test.superpass.htb;</span><span class="w">

    </span><span class="err">location</span><span class="w"> </span><span class="err">/static</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">alias</span><span class="w"> </span><span class="err">/app/app-testing/superpass/static;</span><span class="w">
        </span><span class="err">expires</span><span class="w"> </span><span class="mi">365</span><span class="err">d;</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="err">location</span><span class="w"> </span><span class="err">/</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">include</span><span class="w"> </span><span class="err">uwsgi_params;</span><span class="w">
        </span><span class="err">proxy_pass</span><span class="w"> </span><span class="err">http://</span><span class="mf">127.0</span><span class="err">.</span><span class="mf">0.1</span><span class="err">:</span><span class="mi">5555</span><span class="err">;</span><span class="w">
        </span><span class="err">proxy_set_header</span><span class="w"> </span><span class="err">Host</span><span class="w"> </span><span class="err">$host;</span><span class="w">
        </span><span class="err">proxy_set_header</span><span class="w"> </span><span class="err">X-Real-IP</span><span class="w"> </span><span class="err">$remote_addr;</span><span class="w">
        </span><span class="err">proxy_set_header</span><span class="w"> </span><span class="err">X-Forwarded-Protocol</span><span class="w"> </span><span class="err">$scheme;</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Running <code class="language-plaintext highlighter-rouge">ps aux</code> showed the process running as the user <code class="language-plaintext highlighter-rouge">runner</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230324122624.png" alt="" data-proofer-ignore></p>

<p>So I setup an SSH tunnel using <code class="language-plaintext highlighter-rouge">-L 5555:test.superpass.htb:5555</code> and edited my <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file to map <code class="language-plaintext highlighter-rouge">test.superpass.htb</code> to <code class="language-plaintext highlighter-rouge">debian.local</code> (my localhost). It worked, and I can now access the server;</p>

<p><img data-src="/assets/img/Pasted image 20230324123000.png" alt="" data-proofer-ignore></p>

<p>This looks very similar to the public facing website. The sources are in <code class="language-plaintext highlighter-rouge">/app/app-testing</code>, and are owned by <code class="language-plaintext highlighter-rouge">runner</code>. The file <code class="language-plaintext highlighter-rouge">/app/config_test.json</code> is interesting, and is readable by <code class="language-plaintext highlighter-rouge">runner</code>, which the server is running as. Testing the LFI bug discovered earlier on the public instance, the local instance seems to be not vulnerable as it simply logs out the user;</p>

<p><img data-src="/assets/img/Pasted image 20230324123446.png" alt="" data-proofer-ignore></p>

<p>Checking the source at <code class="language-plaintext highlighter-rouge">/app/app-testing/superpass/views/vault_views.py</code>, I realised why;</p>

<p><img data-src="/assets/img/Pasted image 20230324123734.png" alt="" data-proofer-ignore></p>

<p>The application is checking to make sure the requested file’s extension ends with <code class="language-plaintext highlighter-rouge">.csv</code>. This would have complicated things, but since we already have a shell on the box, we could exploit this by creating a <em>symbolic link</em> whose name ends with <code class="language-plaintext highlighter-rouge">.csv</code> and point it to any file we wish.</p>

<p>My first attempt at doing this was to create the symlink in <code class="language-plaintext highlighter-rouge">/tmp</code> (<code class="language-plaintext highlighter-rouge">/var/tmp</code>). It didn’t work. I realized that all symlinks created in this directory by a user cannot be used by another user even if the other user has the required permissions on the destination file of the symlink. More <a href="https://superuser.com/questions/1157004/following-another-users-symlink">on this here</a></p>

<p>Since I am working as the user <code class="language-plaintext highlighter-rouge">corum</code>, I made my home directory readble and executable to <em>others</em> on the box. This is to allow <code class="language-plaintext highlighter-rouge">runner</code> to access files in <em>corum’s</em> home directory. I then created a symlink to the file <code class="language-plaintext highlighter-rouge">/app/config_test.json</code>. It worked, and I got a MySQL cred;</p>

<p><img data-src="/assets/img/Pasted image 20230324125600.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230324125628.png" alt="" data-proofer-ignore></p>

<p>A credential was found in the database for the user <code class="language-plaintext highlighter-rouge">edwards</code>, and the password <code class="language-plaintext highlighter-rouge">d07867c6267dcb5df0af</code> gave me access to his local account over SSH;</p>

<p><img data-src="/assets/img/Pasted image 20230324130116.png" alt="" data-proofer-ignore></p>

<p>The user <code class="language-plaintext highlighter-rouge">edwards</code> has permissions to use <code class="language-plaintext highlighter-rouge">sudoedit</code> to edit a file with privileges of user and group <code class="language-plaintext highlighter-rouge">dev_admin</code>. You can trigger this with the command;</p>

<div class="language-bash highlighter-rouge"><div class="code-header"><span label-text="Shell"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sudoedit <span class="nt">-u</span> dev_admin /app/config_test.json
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">sudoedit</code> uses the <code class="language-plaintext highlighter-rouge">$EDITOR</code> environment variable to decide which editor to use when viewing a file. By setting it to <code class="language-plaintext highlighter-rouge">vim &lt;file&gt;</code>, we could use this to read/write to any file that has permissions for user or group <code class="language-plaintext highlighter-rouge">dev_admin</code>.</p>

<p>Further enumeration showed that <code class="language-plaintext highlighter-rouge">/app/test_and_update.sh</code> is run as cron task by root user;</p>

<div class="language-bash highlighter-rouge"><div class="code-header"><span label-text="Shell"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c"># update prod with latest from testing constantly assuming tests are passing</span>

<span class="nb">echo</span> <span class="s2">"Starting test_and_update"</span>
<span class="nb">date</span>

<span class="c"># if already running, exit</span>
ps auxww | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"grep"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"pytest"</span> <span class="o">&amp;&amp;</span> <span class="nb">exit

echo</span> <span class="s2">"Not already running. Starting..."</span>

<span class="c"># start in dev folder</span>
<span class="nb">cd</span> /app/app-testing

<span class="c"># system-wide source doesn't seem to happen in cron jobs</span>
<span class="nb">source</span> /app/venv/bin/activate

<span class="c"># run tests, exit if failure</span>
pytest <span class="nt">-x</span> 2&gt;&amp;1 <span class="o">&gt;</span>/dev/null <span class="o">||</span> <span class="nb">exit</span>

<span class="c"># tests good, update prod (flask debug mode will load it instantly)</span>
<span class="nb">cp</span> <span class="nt">-r</span> superpass /app/app/
<span class="nb">echo</span> <span class="s2">"Complete!"</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The script simply activates a python virtual environment by <em>sourcing</em> <code class="language-plaintext highlighter-rouge">/app/venv/bin/activate</code>, run some tests using <code class="language-plaintext highlighter-rouge">pytest</code>, and copy all the contents of <code class="language-plaintext highlighter-rouge">/app/app-testing/superpass/</code> to <code class="language-plaintext highlighter-rouge">/app/app/</code>. Checking the permissions of the files involved, <code class="language-plaintext highlighter-rouge">/app/venv/bin/activate</code> was found to be <strong>writable</strong> to the group <code class="language-plaintext highlighter-rouge">dev_admin</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230324131518.png" alt="" data-proofer-ignore></p>

<p>This is very interesting since the file is executed as a script. Setting my <code class="language-plaintext highlighter-rouge">$EDITOR</code> variable to <code class="language-plaintext highlighter-rouge">vim /app/venv/bin/activate</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230324131854.png" alt="" data-proofer-ignore></p>

<p>Strangely, it opened the file in read-only mode. I had to add <code class="language-plaintext highlighter-rouge">--</code> between <code class="language-plaintext highlighter-rouge">vim</code> and the target file before it worked;</p>

<div class="language-bash highlighter-rouge"><div class="code-header"><span label-text="Shell"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">EDITOR</span><span class="o">=</span><span class="s1">'vim -- /app/venv/bin/activate'</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="/assets/img/Pasted image 20230324132404.png" alt="" data-proofer-ignore></p>

<p>Few seconds later, I got a shell;</p>

<p><img data-src="/assets/img/Pasted image 20230324132547.png" alt="" data-proofer-ignore></p>

<hr />
<p><br /></p>

<h3 id="summary">Summary<a href="#summary" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>
<p><br /></p>

<ul>
  <li>Web app has open registration.
    <ul>
      <li>It is a web-based password manager.</li>
      <li>Export feature found to be vulnerable to LFI.</li>
      <li>Exploited it to generate Werkzeug console PIN, and gained RCE.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">www-data</code>;
    <ul>
      <li>Recovered creds of user <code class="language-plaintext highlighter-rouge">corum</code> from local MySQL using creds in <code class="language-plaintext highlighter-rouge">/app/config_prod.json</code>.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">corum</code>;
    <ul>
      <li>Got <code class="language-plaintext highlighter-rouge">user.txt</code></li>
      <li>Setup an SSH tunnel to access <code class="language-plaintext highlighter-rouge">test.superpass.htb:5555</code>.</li>
      <li>Bypassed LFI filter using local symlinks to dump <code class="language-plaintext highlighter-rouge">/app/config_test.json</code>.</li>
      <li>Used it access local MySQL and found creds for <code class="language-plaintext highlighter-rouge">edwards</code>.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">edwards</code>;
    <ul>
      <li><code class="language-plaintext highlighter-rouge">sudoedit</code> perms to <code class="language-plaintext highlighter-rouge">/app/config_test.json</code> as user/group <code class="language-plaintext highlighter-rouge">dev_admin</code>.</li>
      <li>Identified a cron task running <code class="language-plaintext highlighter-rouge">/app/test_and_update.sh</code> which uses a python virtual env.</li>
      <li>Virtual env setup file is writable to group <code class="language-plaintext highlighter-rouge">dev_admin</code>.</li>
      <li>Exploited it to inject a BASH reverse shell, and got a shell as <code class="language-plaintext highlighter-rouge">root</code>.</li>
    </ul>
  </li>
</ul>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories --><div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i><a href='/categories/hackthebox/'>hackthebox</a></div><!-- tags --><div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i><a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >hackthebox</a><a href="/tags/linux/"
          class="post-tag no-text-decoration" >linux</a><a href="/tags/web/"
          class="post-tag no-text-decoration" >web</a><a href="/tags/medium/"
          class="post-tag no-text-decoration" >medium</a><a href="/tags/werkzeug/"
          class="post-tag no-text-decoration" >werkzeug</a><a href="/tags/werkzeug-console/"
          class="post-tag no-text-decoration" >werkzeug console</a><a href="/tags/lfi/"
          class="post-tag no-text-decoration" >lfi</a><a href="/tags/mysql/"
          class="post-tag no-text-decoration" >mysql</a><a href="/tags/tunneling/"
          class="post-tag no-text-decoration" >tunneling</a><a href="/tags/sudoedit/"
          class="post-tag no-text-decoration" >sudoedit</a><a href="/tags/sudo/"
          class="post-tag no-text-decoration" >sudo</a><a href="/tags/virtualenv/"
          class="post-tag no-text-decoration" >virtualenv</a></div><div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a> by the author.</div><!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons"><a href="https://twitter.com/intent/tweet?text=Agile - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/agile.html" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a><a href="https://www.facebook.com/sharer/sharer.php?title=Agile - HackTheBox - 4g3nt47&u=https://4g3nt47.github.io/posts/hackthebox/agile.html" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a><a href="https://telegram.me/share?text=Agile - HackTheBox - 4g3nt47&url=https://4g3nt47.github.io/posts/hackthebox/agile.html" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a><i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span>
</div>
</div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

</div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

    <div class="access"><!--<div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/lfi/">lfi</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/easy/">easy</a></div>
  </div>-->
    </div><!-- BS-toc.js will be loaded at medium priority -->
<script src="/assets/js/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div></div>

</div>

<!-- tail --><div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  --><!-- An random integer that bigger than 0  --><!-- Equals to TAG_SCORE / {max_categories_hierarchy}  --><!-- Fill with the other newlest posts  --><div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4"><div class="card">
        <a href="/posts/hackthebox/only4you.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2023-08-26 00:00:00 +0100">Aug 26, 2023</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>OnlyForYou - HackTheBox</h3>
            <div class="text-muted small">
              <p>OnlyForYou is a medium linux box on HackTheBox. It starts with exploiting an LFI vulnerability to leak application source code, which reveals a code injection vulnerability. Once inside the box, yo...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/format.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2023-09-30 00:00:00 +0100">Sep 30, 2023</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Format - HackTheBox</h3>
            <div class="text-muted small">
              <p>Format is a nice medium linux machine on HackTheBox. It features a custom web application for creating blogs that is vulnerable to arbitrary read and write, which is easy to detect as the full appl...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/jupiter.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2023-10-22 00:00:00 +0100">Oct 22, 2023</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Jupiter - HackTheBox</h3>
            <div class="text-muted small">
              <p>Jupiter is a very nice medium linux box on HackTheBox. It starts with exploiting an instance of Grafana that’s making an API call containing full SQL queries, which are executed without validation....
              </p>
            </div>
          </div>
        </a>
      </div></div> <!-- .card-deck -->
  </div> <!-- #related-posts --><!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between"><a href="/posts/ctf/payback.html" class="btn btn-outline-primary"
    prompt="Older">
    <p>Payback - OdysseyCTF</p>
  </a><a href="/posts/hackthebox/busqueda.html" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Busqueda - HackTheBox</p>
  </a></div>
<!--  The comments switcher --></div>
  </div>
</div> <!-- .row --><!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2024
        <a href="https://twitter.com/UmarAbdoul">Umar Abdul</a>.<span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p>
    </div>

    <div class="footer-right">
      <p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>
</div><!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints"><div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/lfi/">lfi</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/easy/">easy</a></div>
  </div></div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>
</div> <!-- #main-wrapper --><div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a><!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
--><script src="/assets/js/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
<!--
  JS selector for site.
-->

<!-- layout specified --><!-- image lazy-loading & popup -->
  <script src="/assets/js/clipboard.min.js"></script><script defer src="/assets/js/dist/post.min.js"></script><!-- commons -->

<script src="/assets/js/bootstrap.min.js"></script></body>

</html>
